PYTHONPATH=/home/ylu130/workspace/in-context-generalization
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s42-rTrue --rationales --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-07 20:18:46,498] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  1%|█▎                                                                                          | 145/9741 [00:00<00:06, 1442.16it/s]  3%|██▋                                                                                         | 290/9741 [00:00<00:06, 1441.08it/s]  4%|████                                                                                        | 435/9741 [00:00<00:06, 1445.03it/s]  6%|█████▍                                                                                      | 581/9741 [00:00<00:06, 1447.87it/s]  7%|██████▊                                                                                     | 726/9741 [00:00<00:06, 1437.26it/s]  9%|████████▏                                                                                   | 873/9741 [00:00<00:06, 1445.07it/s] 10%|█████████▌                                                                                 | 1019/9741 [00:00<00:06, 1447.58it/s] 12%|██████████▉                                                                                | 1165/9741 [00:00<00:05, 1435.31it/s] 13%|████████████▏                                                                              | 1309/9741 [00:00<00:05, 1435.95it/s] 15%|█████████████▌                                                                             | 1454/9741 [00:01<00:05, 1438.04it/s] 16%|██████████████▉                                                                            | 1598/9741 [00:01<00:05, 1438.22it/s] 18%|████████████████▎                                                                          | 1744/9741 [00:01<00:05, 1441.86it/s] 19%|█████████████████▋                                                                         | 1889/9741 [00:01<00:05, 1407.46it/s] 21%|███████████████████                                                                        | 2034/9741 [00:01<00:05, 1418.34it/s] 22%|████████████████████▎                                                                      | 2180/9741 [00:01<00:05, 1428.75it/s] 24%|█████████████████████▋                                                                     | 2325/9741 [00:01<00:05, 1433.39it/s] 25%|███████████████████████                                                                    | 2472/9741 [00:01<00:05, 1442.47it/s] 27%|████████████████████████▍                                                                  | 2617/9741 [00:01<00:04, 1434.85it/s] 28%|█████████████████████████▊                                                                 | 2761/9741 [00:01<00:04, 1433.44it/s] 30%|███████████████████████████▏                                                               | 2907/9741 [00:02<00:04, 1439.63it/s] 31%|████████████████████████████▌                                                              | 3051/9741 [00:02<00:04, 1439.34it/s] 33%|█████████████████████████████▊                                                             | 3196/9741 [00:02<00:04, 1441.02it/s] 34%|███████████████████████████████▏                                                           | 3342/9741 [00:02<00:04, 1444.24it/s] 36%|████████████████████████████████▌                                                          | 3487/9741 [00:02<00:04, 1445.74it/s] 37%|█████████████████████████████████▉                                                         | 3632/9741 [00:02<00:04, 1445.39it/s] 39%|███████████████████████████████████▎                                                       | 3778/9741 [00:02<00:04, 1449.61it/s] 40%|████████████████████████████████████▋                                                      | 3924/9741 [00:02<00:04, 1450.06it/s] 42%|██████████████████████████████████████                                                     | 4070/9741 [00:02<00:03, 1447.54it/s] 43%|███████████████████████████████████████▍                                                   | 4215/9741 [00:02<00:03, 1447.58it/s] 45%|████████████████████████████████████████▋                                                  | 4360/9741 [00:03<00:03, 1446.28it/s] 46%|██████████████████████████████████████████                                                 | 4505/9741 [00:03<00:03, 1445.73it/s] 48%|███████████████████████████████████████████▍                                               | 4650/9741 [00:03<00:03, 1407.39it/s] 49%|████████████████████████████████████████████▊                                              | 4791/9741 [00:03<00:04, 1096.57it/s] 51%|██████████████████████████████████████████████                                             | 4936/9741 [00:03<00:04, 1183.28it/s] 52%|███████████████████████████████████████████████▍                                           | 5081/9741 [00:03<00:03, 1251.31it/s] 54%|████████████████████████████████████████████████▊                                          | 5226/9741 [00:03<00:03, 1303.96it/s] 55%|██████████████████████████████████████████████████▏                                        | 5371/9741 [00:03<00:03, 1344.47it/s] 57%|███████████████████████████████████████████████████▌                                       | 5517/9741 [00:03<00:03, 1377.17it/s] 58%|████████████████████████████████████████████████████▉                                      | 5667/9741 [00:04<00:02, 1411.36it/s] 60%|██████████████████████████████████████████████████████▎                                    | 5818/9741 [00:04<00:02, 1439.41it/s] 61%|███████████████████████████████████████████████████████▋                                   | 5967/9741 [00:04<00:02, 1453.45it/s] 63%|█████████████████████████████████████████████████████████▏                                 | 6116/9741 [00:04<00:02, 1462.73it/s] 64%|██████████████████████████████████████████████████████████▌                                | 6264/9741 [00:04<00:02, 1459.89it/s] 66%|███████████████████████████████████████████████████████████▉                               | 6413/9741 [00:04<00:02, 1467.51it/s] 67%|█████████████████████████████████████████████████████████████▎                             | 6561/9741 [00:04<00:02, 1470.95it/s] 69%|██████████████████████████████████████████████████████████████▋                            | 6711/9741 [00:04<00:02, 1477.09it/s] 70%|████████████████████████████████████████████████████████████████                           | 6861/9741 [00:04<00:01, 1483.78it/s] 72%|█████████████████████████████████████████████████████████████████▍                         | 7011/9741 [00:04<00:01, 1485.66it/s] 74%|██████████████████████████████████████████████████████████████████▉                        | 7162/9741 [00:05<00:01, 1491.97it/s] 75%|████████████████████████████████████████████████████████████████████▎                      | 7312/9741 [00:05<00:01, 1492.34it/s] 77%|█████████████████████████████████████████████████████████████████████▋                     | 7462/9741 [00:05<00:01, 1451.57it/s] 78%|███████████████████████████████████████████████████████████████████████                    | 7612/9741 [00:05<00:01, 1464.47it/s] 80%|████████████████████████████████████████████████████████████████████████▍                  | 7759/9741 [00:05<00:01, 1464.87it/s] 81%|█████████████████████████████████████████████████████████████████████████▊                 | 7906/9741 [00:05<00:01, 1465.40it/s] 83%|███████████████████████████████████████████████████████████████████████████▏               | 8055/9741 [00:05<00:01, 1470.62it/s] 84%|████████████████████████████████████████████████████████████████████████████▋              | 8203/9741 [00:05<00:01, 1461.21it/s] 86%|██████████████████████████████████████████████████████████████████████████████             | 8353/9741 [00:05<00:00, 1467.77it/s] 87%|███████████████████████████████████████████████████████████████████████████████▍           | 8503/9741 [00:05<00:00, 1475.87it/s] 89%|████████████████████████████████████████████████████████████████████████████████▊          | 8652/9741 [00:06<00:00, 1478.05it/s] 90%|██████████████████████████████████████████████████████████████████████████████████▏        | 8802/9741 [00:06<00:00, 1483.22it/s] 92%|███████████████████████████████████████████████████████████████████████████████████▋       | 8952/9741 [00:06<00:00, 1485.59it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████      | 9101/9741 [00:06<00:00, 1483.89it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████▍    | 9251/9741 [00:06<00:00, 1488.15it/s] 97%|███████████████████████████████████████████████████████████████████████████████████████▊   | 9401/9741 [00:06<00:00, 1490.00it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████▏ | 9551/9741 [00:06<00:00, 1489.52it/s]100%|██████████████████████████████████████████████████████████████████████████████████████████▋| 9701/9741 [00:06<00:00, 1490.23it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1435.11it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.28s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.40s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.42s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.52s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.55s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.49s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.44s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]
[2023-08-07 20:19:44,425] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.98s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.78s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.96s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.18s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.26s/it]
[2023-08-07 20:19:57,815] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 20:19:57,816] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 20:19:57,816] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 20:19:57,816] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 20:19:57,816] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 20:19:57,816] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fb35be4d7c0>
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 20:19:57,817] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fb35be4deb0>
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 20:19:57,818] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 20:19:57,819] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 20:19:57,819] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 20:19:57,819] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 20:19:57,819] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 20:19:57,819] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 20:19:57,819] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.42271971702575684 seconds
Loading extension module utils...
Time to load utils op: 0.40461087226867676 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.404590368270874 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Rationales: The problem states that the family recycles 144 cans and 20 kilograms of newspapers. We are given the recycle value for a set number of cans and newspapers: every 12 cans are worth $0.50, and every 5 kilograms of newspapers is worth $1.50.

To find out how much money the family can earn from recycling cans, we need to divide the total number of cans by the number of cans needed to earn $0.50: 144/12 = 12 sets. Then multiply the sets of cans by the value of each set: $0.50 x 12 = $6.

Applying the same steps to the newspapers, we divide the total weight of the newspapers by the weight needed to earn $1.50: 20/5 = 4 sets. Then multiply the sets of newspapers by the value of each set: $1.50 x 4 = $6.

Finally, we add the values earned from cans and newspapers together: $6 (cans) + $6 (newspapers) = $12. Therefore, the family would receive $12 in total.
Answer: 12

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s42-rTrue
Loading extension module utils...
Time to load utils op: 0.5045218467712402 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:34<28:14, 34.59s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:28<36:56, 46.17s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:19<37:40, 48.10s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [03:12<38:23, 50.09s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [04:04<38:01, 50.69s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [04:56<37:40, 51.38s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:49<37:03, 51.70s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [06:41<36:20, 51.92s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [07:33<35:32, 52.00s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [08:25<34:36, 51.91s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [09:17<33:46, 51.96s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [10:10<33:07, 52.32s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [11:03<32:19, 52.42s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [11:56<31:31, 52.54s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [12:23<26:11, 44.91s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [13:15<26:43, 47.16s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [14:06<26:34, 48.32s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [14:58<26:21, 49.42s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [15:50<25:49, 49.98s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [16:42<25:17, 50.58s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [17:25<23:23, 48.41s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [18:17<23:09, 49.63s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [18:46<19:27, 43.25s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [19:38<19:51, 45.84s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [20:11<17:36, 42.24s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [21:03<17:57, 44.91s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [21:57<18:16, 47.68s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [22:50<18:07, 49.42s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [23:43<17:36, 50.33s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [24:35<17:01, 51.05s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [25:26<16:07, 50.91s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [26:15<15:06, 50.34s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [27:06<14:21, 50.66s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [27:58<13:34, 50.93s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [28:51<12:53, 51.54s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [29:30<11:09, 47.85s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [30:22<10:38, 49.15s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [31:14<10:00, 50.01s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [32:07<09:18, 50.80s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [32:49<08:02, 48.29s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [33:43<07:29, 49.96s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [34:22<06:12, 46.50s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [34:54<04:54, 42.09s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [35:46<04:31, 45.24s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [36:33<03:47, 45.59s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [37:15<02:58, 44.75s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [38:09<02:22, 47.42s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [38:38<01:23, 41.97s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [39:31<00:45, 45.16s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:16<00:00, 45.08s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:16<00:00, 48.32s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.7659} | lm_loss 7.7841 | avg. gen lenth: 229.308
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s42-rTrue --rationales --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-07 21:01:25,492] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  1%|▌                                                                                             | 53/9741 [00:00<00:18, 526.00it/s]  1%|█                                                                                            | 107/9741 [00:00<00:18, 529.47it/s]  2%|█▌                                                                                           | 161/9741 [00:00<00:18, 530.65it/s]  2%|██                                                                                           | 215/9741 [00:00<00:18, 527.49it/s]  3%|██▌                                                                                          | 268/9741 [00:00<00:17, 527.48it/s]  3%|███                                                                                          | 322/9741 [00:00<00:17, 528.55it/s]  4%|███▌                                                                                         | 375/9741 [00:00<00:18, 520.10it/s]  4%|████                                                                                         | 428/9741 [00:00<00:17, 521.64it/s]  5%|████▌                                                                                        | 481/9741 [00:00<00:17, 519.58it/s]  5%|█████                                                                                        | 534/9741 [00:01<00:17, 522.22it/s]  6%|█████▌                                                                                       | 587/9741 [00:01<00:17, 523.57it/s]  7%|██████                                                                                       | 640/9741 [00:01<00:17, 525.29it/s]  7%|██████▌                                                                                      | 693/9741 [00:01<00:17, 524.91it/s]  8%|███████                                                                                      | 746/9741 [00:01<00:17, 525.26it/s]  8%|███████▋                                                                                     | 799/9741 [00:01<00:16, 526.66it/s]  9%|████████▏                                                                                    | 853/9741 [00:01<00:16, 528.04it/s]  9%|████████▋                                                                                    | 906/9741 [00:01<00:16, 523.81it/s] 10%|█████████▏                                                                                   | 959/9741 [00:01<00:16, 524.54it/s] 10%|█████████▌                                                                                  | 1012/9741 [00:01<00:16, 525.09it/s] 11%|██████████                                                                                  | 1065/9741 [00:02<00:16, 525.71it/s] 11%|██████████▌                                                                                 | 1118/9741 [00:02<00:16, 524.23it/s] 12%|███████████                                                                                 | 1171/9741 [00:02<00:16, 525.43it/s] 13%|███████████▌                                                                                | 1224/9741 [00:02<00:16, 526.09it/s] 13%|████████████                                                                                | 1277/9741 [00:02<00:16, 526.15it/s] 14%|████████████▌                                                                               | 1330/9741 [00:02<00:15, 526.25it/s] 14%|█████████████▏                                                                              | 1402/9741 [00:02<00:14, 583.86it/s] 15%|██████████████                                                                              | 1483/9741 [00:02<00:12, 649.33it/s] 16%|██████████████▊                                                                             | 1564/9741 [00:02<00:11, 696.70it/s] 17%|███████████████▌                                                                            | 1644/9741 [00:02<00:11, 727.23it/s] 18%|████████████████▎                                                                           | 1725/9741 [00:03<00:10, 750.80it/s] 18%|█████████████████                                                                           | 1801/9741 [00:03<00:10, 741.95it/s] 19%|█████████████████▋                                                                          | 1876/9741 [00:03<00:10, 741.01it/s] 20%|██████████████████▍                                                                         | 1957/9741 [00:03<00:10, 759.50it/s] 21%|███████████████████▏                                                                        | 2036/9741 [00:03<00:10, 768.36it/s] 22%|███████████████████▉                                                                        | 2117/9741 [00:03<00:09, 777.94it/s] 23%|████████████████████▊                                                                       | 2198/9741 [00:03<00:09, 786.22it/s] 23%|█████████████████████▌                                                                      | 2278/9741 [00:03<00:09, 788.96it/s] 24%|██████████████████████▎                                                                     | 2357/9741 [00:03<00:09, 785.55it/s] 25%|███████████████████████                                                                     | 2436/9741 [00:03<00:09, 784.33it/s] 26%|███████████████████████▊                                                                    | 2516/9741 [00:04<00:09, 786.16it/s] 27%|████████████████████████▌                                                                   | 2597/9741 [00:04<00:09, 791.08it/s] 27%|█████████████████████████▎                                                                  | 2678/9741 [00:04<00:08, 794.20it/s] 28%|██████████████████████████                                                                  | 2758/9741 [00:04<00:08, 789.66it/s] 29%|██████████████████████████▊                                                                 | 2838/9741 [00:04<00:08, 792.45it/s] 30%|███████████████████████████▌                                                                | 2918/9741 [00:04<00:08, 777.52it/s] 31%|████████████████████████████▎                                                               | 2998/9741 [00:04<00:08, 782.25it/s] 32%|█████████████████████████████                                                               | 3078/9741 [00:04<00:08, 786.28it/s] 32%|█████████████████████████████▊                                                              | 3158/9741 [00:04<00:08, 788.60it/s] 33%|██████████████████████████████▌                                                             | 3239/9741 [00:04<00:08, 793.75it/s] 34%|███████████████████████████████▎                                                            | 3320/9741 [00:05<00:08, 796.81it/s] 35%|████████████████████████████████                                                            | 3400/9741 [00:05<00:08, 787.06it/s] 36%|████████████████████████████████▊                                                           | 3479/9741 [00:05<00:08, 782.29it/s] 37%|█████████████████████████████████▌                                                          | 3559/9741 [00:05<00:07, 786.68it/s] 37%|██████████████████████████████████▎                                                         | 3638/9741 [00:05<00:07, 787.07it/s] 38%|███████████████████████████████████                                                         | 3718/9741 [00:05<00:07, 790.88it/s] 39%|███████████████████████████████████▊                                                        | 3798/9741 [00:05<00:07, 789.13it/s] 40%|████████████████████████████████████▋                                                       | 3878/9741 [00:05<00:07, 789.96it/s] 41%|█████████████████████████████████████▍                                                      | 3958/9741 [00:05<00:07, 774.88it/s] 41%|██████████████████████████████████████▏                                                     | 4039/9741 [00:05<00:07, 782.56it/s] 42%|██████████████████████████████████████▉                                                     | 4118/9741 [00:06<00:07, 784.09it/s] 43%|███████████████████████████████████████▋                                                    | 4198/9741 [00:06<00:07, 788.35it/s] 44%|████████████████████████████████████████▍                                                   | 4279/9741 [00:06<00:06, 792.57it/s] 45%|█████████████████████████████████████████▏                                                  | 4359/9741 [00:06<00:06, 792.90it/s] 46%|█████████████████████████████████████████▉                                                  | 4440/9741 [00:06<00:06, 795.32it/s] 46%|██████████████████████████████████████████▋                                                 | 4520/9741 [00:06<00:07, 744.18it/s] 47%|███████████████████████████████████████████▍                                                | 4600/9741 [00:06<00:06, 758.74it/s] 48%|████████████████████████████████████████████▏                                               | 4680/9741 [00:06<00:06, 770.18it/s] 49%|████████████████████████████████████████████▉                                               | 4758/9741 [00:07<00:08, 581.77it/s] 50%|█████████████████████████████████████████████▋                                              | 4838/9741 [00:07<00:07, 633.50it/s] 50%|██████████████████████████████████████████████▍                                             | 4912/9741 [00:07<00:07, 659.47it/s] 51%|███████████████████████████████████████████████▏                                            | 4991/9741 [00:07<00:06, 693.92it/s] 52%|███████████████████████████████████████████████▉                                            | 5071/9741 [00:07<00:06, 721.14it/s] 53%|████████████████████████████████████████████████▋                                           | 5151/9741 [00:07<00:06, 742.04it/s] 54%|█████████████████████████████████████████████████▍                                          | 5230/9741 [00:07<00:05, 755.11it/s] 55%|██████████████████████████████████████████████████▏                                         | 5310/9741 [00:07<00:05, 767.88it/s] 55%|██████████████████████████████████████████████████▉                                         | 5390/9741 [00:07<00:05, 777.26it/s] 56%|███████████████████████████████████████████████████▋                                        | 5469/9741 [00:07<00:05, 765.88it/s] 57%|████████████████████████████████████████████████████▍                                       | 5552/9741 [00:08<00:05, 784.40it/s] 58%|█████████████████████████████████████████████████████▏                                      | 5634/9741 [00:08<00:05, 792.97it/s] 59%|█████████████████████████████████████████████████████▉                                      | 5716/9741 [00:08<00:05, 798.81it/s] 60%|██████████████████████████████████████████████████████▊                                     | 5799/9741 [00:08<00:04, 807.88it/s] 60%|███████████████████████████████████████████████████████▌                                    | 5882/9741 [00:08<00:04, 812.36it/s] 61%|████████████████████████████████████████████████████████▎                                   | 5964/9741 [00:08<00:04, 801.40it/s] 62%|█████████████████████████████████████████████████████████                                   | 6048/9741 [00:08<00:04, 810.76it/s] 63%|█████████████████████████████████████████████████████████▉                                  | 6130/9741 [00:08<00:04, 812.83it/s] 64%|██████████████████████████████████████████████████████████▋                                 | 6214/9741 [00:08<00:04, 818.60it/s] 65%|███████████████████████████████████████████████████████████▍                                | 6297/9741 [00:08<00:04, 821.62it/s] 65%|████████████████████████████████████████████████████████████▎                               | 6380/9741 [00:09<00:04, 822.14it/s] 66%|█████████████████████████████████████████████████████████████                               | 6464/9741 [00:09<00:03, 824.97it/s] 67%|█████████████████████████████████████████████████████████████▊                              | 6547/9741 [00:09<00:03, 806.80it/s] 68%|██████████████████████████████████████████████████████████████▌                             | 6630/9741 [00:09<00:03, 813.44it/s] 69%|███████████████████████████████████████████████████████████████▍                            | 6713/9741 [00:09<00:03, 817.70it/s] 70%|████████████████████████████████████████████████████████████████▏                           | 6796/9741 [00:09<00:03, 819.08it/s] 71%|████████████████████████████████████████████████████████████████▉                           | 6879/9741 [00:09<00:03, 822.09it/s] 71%|█████████████████████████████████████████████████████████████████▊                          | 6963/9741 [00:09<00:03, 825.49it/s] 72%|██████████████████████████████████████████████████████████████████▌                         | 7046/9741 [00:09<00:03, 808.71it/s] 73%|███████████████████████████████████████████████████████████████████▎                        | 7130/9741 [00:09<00:03, 815.14it/s] 74%|████████████████████████████████████████████████████████████████████                        | 7213/9741 [00:10<00:03, 818.14it/s] 75%|████████████████████████████████████████████████████████████████████▉                       | 7296/9741 [00:10<00:02, 819.03it/s] 76%|█████████████████████████████████████████████████████████████████████▋                      | 7380/9741 [00:10<00:02, 822.92it/s] 77%|██████████████████████████████████████████████████████████████████████▍                     | 7463/9741 [00:10<00:02, 790.15it/s] 77%|███████████████████████████████████████████████████████████████████████▏                    | 7543/9741 [00:10<00:02, 790.38it/s] 78%|████████████████████████████████████████████████████████████████████████                    | 7624/9741 [00:10<00:02, 794.74it/s] 79%|████████████████████████████████████████████████████████████████████████▊                   | 7706/9741 [00:10<00:02, 802.09it/s] 80%|█████████████████████████████████████████████████████████████████████████▌                  | 7789/9741 [00:10<00:02, 809.62it/s] 81%|██████████████████████████████████████████████████████████████████████████▎                 | 7873/9741 [00:10<00:02, 816.25it/s] 82%|███████████████████████████████████████████████████████████████████████████▏                | 7956/9741 [00:10<00:02, 818.68it/s] 83%|███████████████████████████████████████████████████████████████████████████▉                | 8040/9741 [00:11<00:02, 822.31it/s] 83%|████████████████████████████████████████████████████████████████████████████▋               | 8123/9741 [00:11<00:02, 808.23it/s] 84%|█████████████████████████████████████████████████████████████████████████████▍              | 8205/9741 [00:11<00:01, 811.67it/s] 85%|██████████████████████████████████████████████████████████████████████████████▎             | 8288/9741 [00:11<00:01, 816.82it/s] 86%|███████████████████████████████████████████████████████████████████████████████             | 8370/9741 [00:11<00:01, 817.56it/s] 87%|███████████████████████████████████████████████████████████████████████████████▊            | 8454/9741 [00:11<00:01, 822.35it/s] 88%|████████████████████████████████████████████████████████████████████████████████▋           | 8537/9741 [00:11<00:01, 824.60it/s] 88%|█████████████████████████████████████████████████████████████████████████████████▍          | 8620/9741 [00:11<00:01, 823.23it/s] 89%|██████████████████████████████████████████████████████████████████████████████████▏         | 8703/9741 [00:11<00:01, 809.20it/s] 90%|██████████████████████████████████████████████████████████████████████████████████▉         | 8786/9741 [00:12<00:01, 815.06it/s] 91%|███████████████████████████████████████████████████████████████████████████████████▊        | 8868/9741 [00:12<00:01, 815.97it/s] 92%|████████████████████████████████████████████████████████████████████████████████████▌       | 8952/9741 [00:12<00:00, 821.34it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████▎      | 9035/9741 [00:12<00:00, 821.34it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████      | 9118/9741 [00:12<00:00, 823.26it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████▉     | 9201/9741 [00:12<00:00, 809.76it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████▋    | 9283/9741 [00:12<00:00, 810.91it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████▍   | 9366/9741 [00:12<00:00, 815.47it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████▏  | 9449/9741 [00:12<00:00, 818.98it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████  | 9532/9741 [00:12<00:00, 820.14it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████▊ | 9616/9741 [00:13<00:00, 823.59it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████▌| 9700/9741 [00:13<00:00, 825.92it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:13<00:00, 739.38it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.20s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.14s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.33s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.60s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.02s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.06s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.32s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.62s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.65s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.53s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.68s/it]
[2023-08-07 21:02:30,467] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.67s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.85s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.96s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.14s/it]
[2023-08-07 21:02:40,679] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 21:02:40,680] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 21:02:40,680] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 21:02:40,680] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 21:02:40,680] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 21:02:40,680] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f43408db7c0>
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f43408dbeb0>
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 21:02:40,681] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 21:02:40,682] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 21:02:40,682] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.3976619243621826 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]Loading extension module utils...
############### Example ###############
Time to load utils op: 0.30440807342529297 seconds
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Rationales: The problem involves determining how much money you would receive for recycling cans and newspapers. 

First find out how many sets of 12 cans are in 144 cans. 

This is done by dividing the total number of cans (144) by the number of cans per set (12). 

144 ÷ 12 = 12 sets of cans. 

Each set of can is worth $0.50. 

To calculate the total worth of the cans, multiply the number of sets (12) by the worth of each set ($0.50). 

12 x $0.50 = $6 

Next, find out how many set of 5 kilograms of newspapers are in 20 kilograms. 

This is done by dividing the total kilograms of newspapers (20) by the number of kilograms per set (5). 

20 ÷ 5 = 4 sets of newspapers. 

Each set of newspaper is worth $1.50. 

To calculate the total worth of the newspapers, multiply the number of sets (4) by the worth of each set ($1.50). 

4 x $1.50 = $6 

Finally, to find the total money earned, add the worth of the cans and the newspapers together. 

$6 (for cans) + $6 (for newspapers) = $12.
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Rationales: Betty picked 16 strawberries. 
Then, Matthew picked 20 more strawberries than Betty which makes 16 + 20 = 36 strawberries.
Therefore, Matthew picked 36 strawberries.
We know that Matthew picked twice as many strawberries as Natalie. 
So, Natalie picked 36/2 = 18 strawberries.
The total number of strawberries they all picked is 16 (Betty's) + 36 (Matthew's) + 18 (Natalie's) = 70 strawberries.
Each jar of jam requires 7 strawberries, so they can make 70 strawberries / 7 strawberries per jar = 10 jars of jam.
Each jar of jam is sold for $4, so they made 10 jars * $4 per jar = $40 from the strawberries they picked.
Therefore, they made $40 from selling the strawberries they picked.
Answer: 40

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s42-rTrue
Loading extension module utils...
Time to load utils op: 0.21859431266784668 secondsLoading extension module utils...

Time to load utils op: 0.4049530029296875 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:31<25:23, 31.10s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:16<31:30, 39.39s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:03<33:35, 42.87s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [02:49<33:47, 44.09s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [03:33<33:03, 44.08s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [04:19<32:56, 44.92s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:05<32:23, 45.20s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [05:50<31:39, 45.22s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [06:37<31:14, 45.72s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [07:24<30:41, 46.04s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [08:10<29:59, 46.13s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [08:56<29:12, 46.12s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [09:42<28:25, 46.09s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [10:29<27:42, 46.18s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [11:02<24:40, 42.31s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [11:49<24:42, 43.61s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [12:35<24:22, 44.32s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [13:21<23:59, 44.98s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [14:07<23:24, 45.30s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [14:53<22:46, 45.54s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [15:40<22:13, 45.98s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [16:27<21:32, 46.16s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [17:13<20:41, 45.97s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [18:00<20:04, 46.34s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [18:48<19:29, 46.78s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [19:33<18:36, 46.52s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [20:15<17:16, 45.05s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [21:02<16:41, 45.51s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [21:49<16:05, 46.00s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [22:35<15:21, 46.06s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [23:11<13:37, 43.02s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [23:57<13:10, 43.94s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [24:44<12:41, 44.79s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [25:29<12:00, 45.03s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [26:16<11:21, 45.43s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [27:02<10:39, 45.68s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [27:48<09:56, 45.92s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [28:34<09:10, 45.91s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [29:20<08:25, 45.97s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [30:07<07:41, 46.19s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [30:54<06:56, 46.26s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [31:40<06:09, 46.17s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [32:26<05:22, 46.13s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [33:12<04:37, 46.32s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [33:58<03:50, 46.19s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [34:45<03:05, 46.25s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [35:31<02:19, 46.36s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [36:18<01:32, 46.39s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [37:04<00:46, 46.40s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [37:50<00:00, 46.39s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [37:50<00:00, 45.42s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.5458} | lm_loss 7.9404 | avg. gen lenth: 323.428
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s42-rTrue --rationales --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[2023-08-07 21:41:09,238] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                             | 34/9741 [00:00<00:29, 334.52it/s]  1%|▋                                                                                             | 68/9741 [00:00<00:28, 336.30it/s]  1%|▉                                                                                            | 102/9741 [00:00<00:28, 337.05it/s]  1%|█▎                                                                                           | 136/9741 [00:00<00:28, 337.35it/s]  2%|█▌                                                                                           | 170/9741 [00:00<00:28, 337.46it/s]  2%|█▉                                                                                           | 204/9741 [00:00<00:28, 335.02it/s]  2%|██▎                                                                                          | 238/9741 [00:00<00:28, 329.99it/s]  3%|██▌                                                                                          | 272/9741 [00:00<00:28, 331.24it/s]  3%|██▉                                                                                          | 306/9741 [00:00<00:28, 333.00it/s]  3%|███▏                                                                                         | 340/9741 [00:01<00:28, 333.50it/s]  4%|███▌                                                                                         | 374/9741 [00:01<00:27, 334.66it/s]  4%|███▉                                                                                         | 408/9741 [00:01<00:27, 334.60it/s]  5%|████▏                                                                                        | 442/9741 [00:01<00:27, 333.44it/s]  5%|████▌                                                                                        | 476/9741 [00:01<00:27, 334.47it/s]  5%|████▊                                                                                        | 510/9741 [00:01<00:27, 335.20it/s]  6%|█████▏                                                                                       | 544/9741 [00:01<00:27, 335.62it/s]  6%|█████▌                                                                                       | 578/9741 [00:01<00:27, 332.93it/s]  6%|█████▊                                                                                       | 612/9741 [00:01<00:27, 332.67it/s]  7%|██████▏                                                                                      | 650/9741 [00:01<00:26, 346.50it/s]  7%|██████▋                                                                                      | 701/9741 [00:02<00:22, 393.19it/s]  8%|███████▏                                                                                     | 752/9741 [00:02<00:21, 426.91it/s]  8%|███████▋                                                                                     | 803/9741 [00:02<00:19, 451.18it/s]  9%|████████▏                                                                                    | 854/9741 [00:02<00:18, 468.52it/s]  9%|████████▋                                                                                    | 905/9741 [00:02<00:18, 478.63it/s] 10%|█████████                                                                                    | 954/9741 [00:02<00:18, 480.77it/s] 10%|█████████▍                                                                                  | 1004/9741 [00:02<00:17, 485.73it/s] 11%|█████████▉                                                                                  | 1056/9741 [00:02<00:17, 493.28it/s] 11%|██████████▍                                                                                 | 1107/9741 [00:02<00:17, 497.80it/s] 12%|██████████▉                                                                                 | 1158/9741 [00:02<00:17, 498.78it/s] 12%|███████████▍                                                                                | 1208/9741 [00:03<00:17, 498.28it/s] 13%|███████████▉                                                                                | 1259/9741 [00:03<00:16, 501.34it/s] 13%|████████████▎                                                                               | 1310/9741 [00:03<00:17, 493.89it/s] 14%|████████████▊                                                                               | 1361/9741 [00:03<00:16, 495.97it/s] 14%|█████████████▎                                                                              | 1412/9741 [00:03<00:16, 499.39it/s] 15%|█████████████▊                                                                              | 1463/9741 [00:03<00:16, 501.26it/s] 16%|██████████████▎                                                                             | 1514/9741 [00:03<00:16, 502.48it/s] 16%|██████████████▊                                                                             | 1566/9741 [00:03<00:16, 502.46it/s] 17%|███████████████▎                                                                            | 1617/9741 [00:03<00:16, 503.69it/s] 17%|███████████████▊                                                                            | 1668/9741 [00:03<00:16, 496.42it/s] 18%|████████████████▏                                                                           | 1719/9741 [00:04<00:16, 500.06it/s] 18%|████████████████▋                                                                           | 1770/9741 [00:04<00:15, 502.50it/s] 19%|█████████████████▏                                                                          | 1821/9741 [00:04<00:16, 480.26it/s] 19%|█████████████████▋                                                                          | 1871/9741 [00:04<00:16, 483.84it/s] 20%|██████████████████▏                                                                         | 1922/9741 [00:04<00:15, 490.69it/s] 20%|██████████████████▌                                                                         | 1972/9741 [00:04<00:15, 486.20it/s] 21%|███████████████████                                                                         | 2022/9741 [00:04<00:15, 489.66it/s] 21%|███████████████████▌                                                                        | 2073/9741 [00:04<00:15, 494.44it/s] 22%|████████████████████                                                                        | 2124/9741 [00:04<00:15, 496.98it/s] 22%|████████████████████▌                                                                       | 2175/9741 [00:04<00:15, 500.23it/s] 23%|█████████████████████                                                                       | 2226/9741 [00:05<00:14, 501.96it/s] 23%|█████████████████████▌                                                                      | 2277/9741 [00:05<00:15, 494.03it/s] 24%|█████████████████████▉                                                                      | 2327/9741 [00:05<00:14, 494.87it/s] 24%|██████████████████████▍                                                                     | 2378/9741 [00:05<00:14, 498.95it/s] 25%|██████████████████████▉                                                                     | 2429/9741 [00:05<00:14, 501.52it/s] 25%|███████████████████████▍                                                                    | 2480/9741 [00:05<00:14, 500.29it/s] 26%|███████████████████████▉                                                                    | 2531/9741 [00:05<00:14, 500.20it/s] 27%|████████████████████████▍                                                                   | 2582/9741 [00:05<00:14, 502.40it/s] 27%|████████████████████████▊                                                                   | 2633/9741 [00:05<00:14, 493.47it/s] 28%|█████████████████████████▎                                                                  | 2684/9741 [00:06<00:14, 497.60it/s] 28%|█████████████████████████▊                                                                  | 2734/9741 [00:06<00:14, 497.64it/s] 29%|██████████████████████████▎                                                                 | 2785/9741 [00:06<00:13, 499.79it/s] 29%|██████████████████████████▊                                                                 | 2836/9741 [00:06<00:13, 502.04it/s] 30%|███████████████████████████▎                                                                | 2887/9741 [00:06<00:13, 503.87it/s] 30%|███████████████████████████▋                                                                | 2938/9741 [00:06<00:13, 501.35it/s] 31%|████████████████████████████▏                                                               | 2989/9741 [00:06<00:13, 493.96it/s] 31%|████████████████████████████▋                                                               | 3040/9741 [00:06<00:13, 497.26it/s] 32%|█████████████████████████████▏                                                              | 3091/9741 [00:06<00:13, 499.03it/s] 32%|█████████████████████████████▋                                                              | 3142/9741 [00:06<00:13, 501.12it/s] 33%|██████████████████████████████▏                                                             | 3193/9741 [00:07<00:13, 500.57it/s] 33%|██████████████████████████████▋                                                             | 3244/9741 [00:07<00:12, 502.27it/s] 34%|███████████████████████████████                                                             | 3295/9741 [00:07<00:12, 496.99it/s] 34%|███████████████████████████████▌                                                            | 3345/9741 [00:07<00:12, 495.36it/s] 35%|████████████████████████████████                                                            | 3395/9741 [00:07<00:12, 496.31it/s] 35%|████████████████████████████████▌                                                           | 3446/9741 [00:07<00:12, 498.60it/s] 36%|█████████████████████████████████                                                           | 3497/9741 [00:07<00:12, 500.29it/s] 36%|█████████████████████████████████▌                                                          | 3548/9741 [00:07<00:12, 501.53it/s] 37%|█████████████████████████████████▉                                                          | 3599/9741 [00:07<00:12, 502.98it/s] 37%|██████████████████████████████████▍                                                         | 3650/9741 [00:07<00:12, 493.53it/s] 38%|██████████████████████████████████▉                                                         | 3701/9741 [00:08<00:12, 497.51it/s] 39%|███████████████████████████████████▍                                                        | 3752/9741 [00:08<00:11, 500.76it/s] 39%|███████████████████████████████████▉                                                        | 3803/9741 [00:08<00:11, 502.44it/s] 40%|████████████████████████████████████▍                                                       | 3854/9741 [00:08<00:11, 501.25it/s] 40%|████████████████████████████████████▉                                                       | 3905/9741 [00:08<00:11, 503.24it/s] 41%|█████████████████████████████████████▎                                                      | 3956/9741 [00:08<00:11, 503.10it/s] 41%|█████████████████████████████████████▊                                                      | 4007/9741 [00:08<00:11, 495.56it/s] 42%|██████████████████████████████████████▎                                                     | 4058/9741 [00:08<00:11, 499.10it/s] 42%|██████████████████████████████████████▊                                                     | 4108/9741 [00:08<00:11, 498.72it/s] 43%|███████████████████████████████████████▎                                                    | 4159/9741 [00:08<00:11, 500.85it/s] 43%|███████████████████████████████████████▊                                                    | 4210/9741 [00:09<00:11, 501.12it/s] 44%|████████████████████████████████████████▏                                                   | 4261/9741 [00:09<00:10, 502.68it/s] 44%|████████████████████████████████████████▋                                                   | 4312/9741 [00:09<00:11, 492.74it/s] 45%|█████████████████████████████████████████▏                                                  | 4363/9741 [00:09<00:10, 496.88it/s] 45%|█████████████████████████████████████████▋                                                  | 4414/9741 [00:09<00:10, 499.99it/s] 46%|██████████████████████████████████████████▏                                                 | 4465/9741 [00:09<00:10, 501.39it/s] 46%|██████████████████████████████████████████▋                                                 | 4516/9741 [00:09<00:10, 501.82it/s] 47%|███████████████████████████████████████████▏                                                | 4567/9741 [00:09<00:10, 471.60it/s] 47%|███████████████████████████████████████████▌                                                | 4615/9741 [00:09<00:10, 471.93it/s] 48%|████████████████████████████████████████████                                                | 4666/9741 [00:10<00:10, 482.01it/s] 48%|████████████████████████████████████████████▌                                               | 4717/9741 [00:10<00:10, 489.88it/s] 49%|█████████████████████████████████████████████                                               | 4767/9741 [00:10<00:14, 348.86it/s] 49%|█████████████████████████████████████████████▌                                              | 4818/9741 [00:10<00:12, 385.27it/s] 50%|█████████████████████████████████████████████▉                                              | 4866/9741 [00:10<00:11, 407.16it/s] 50%|██████████████████████████████████████████████▍                                             | 4917/9741 [00:10<00:11, 432.71it/s] 51%|██████████████████████████████████████████████▉                                             | 4967/9741 [00:10<00:10, 450.23it/s] 52%|███████████████████████████████████████████████▍                                            | 5018/9741 [00:10<00:10, 465.16it/s] 52%|███████████████████████████████████████████████▊                                            | 5069/9741 [00:10<00:09, 477.11it/s] 53%|████████████████████████████████████████████████▎                                           | 5120/9741 [00:11<00:09, 485.49it/s] 53%|████████████████████████████████████████████████▊                                           | 5170/9741 [00:11<00:09, 489.06it/s] 54%|█████████████████████████████████████████████████▎                                          | 5220/9741 [00:11<00:09, 482.33it/s] 54%|█████████████████████████████████████████████████▊                                          | 5271/9741 [00:11<00:09, 489.05it/s] 55%|██████████████████████████████████████████████████▎                                         | 5322/9741 [00:11<00:08, 493.98it/s] 55%|██████████████████████████████████████████████████▋                                         | 5373/9741 [00:11<00:08, 497.08it/s] 56%|███████████████████████████████████████████████████▏                                        | 5423/9741 [00:11<00:08, 494.89it/s] 56%|███████████████████████████████████████████████████▋                                        | 5474/9741 [00:11<00:08, 498.64it/s] 57%|████████████████████████████████████████████████████▏                                       | 5524/9741 [00:11<00:08, 496.39it/s] 57%|████████████████████████████████████████████████████▋                                       | 5577/9741 [00:11<00:08, 504.89it/s] 58%|█████████████████████████████████████████████████████▏                                      | 5629/9741 [00:12<00:08, 507.89it/s] 58%|█████████████████████████████████████████████████████▋                                      | 5682/9741 [00:12<00:07, 512.79it/s] 59%|██████████████████████████████████████████████████████▏                                     | 5735/9741 [00:12<00:07, 516.76it/s] 59%|██████████████████████████████████████████████████████▋                                     | 5788/9741 [00:12<00:07, 518.71it/s] 60%|███████████████████████████████████████████████████████▏                                    | 5840/9741 [00:12<00:07, 515.37it/s] 60%|███████████████████████████████████████████████████████▋                                    | 5892/9741 [00:12<00:07, 506.41it/s] 61%|████████████████████████████████████████████████████████▏                                   | 5945/9741 [00:12<00:07, 511.74it/s] 62%|████████████████████████████████████████████████████████▋                                   | 5998/9741 [00:12<00:07, 515.41it/s] 62%|█████████████████████████████████████████████████████████▏                                  | 6051/9741 [00:12<00:07, 518.30it/s] 63%|█████████████████████████████████████████████████████████▋                                  | 6103/9741 [00:12<00:07, 516.90it/s] 63%|██████████████████████████████████████████████████████████▏                                 | 6156/9741 [00:13<00:06, 518.37it/s] 64%|██████████████████████████████████████████████████████████▋                                 | 6208/9741 [00:13<00:06, 509.47it/s] 64%|███████████████████████████████████████████████████████████▏                                | 6261/9741 [00:13<00:06, 513.39it/s] 65%|███████████████████████████████████████████████████████████▌                                | 6313/9741 [00:13<00:06, 514.54it/s] 65%|████████████████████████████████████████████████████████████                                | 6366/9741 [00:13<00:06, 517.52it/s] 66%|████████████████████████████████████████████████████████████▌                               | 6419/9741 [00:13<00:06, 519.64it/s] 66%|█████████████████████████████████████████████████████████████                               | 6471/9741 [00:13<00:06, 519.31it/s] 67%|█████████████████████████████████████████████████████████████▌                              | 6524/9741 [00:13<00:06, 519.92it/s] 68%|██████████████████████████████████████████████████████████████                              | 6576/9741 [00:13<00:06, 507.52it/s] 68%|██████████████████████████████████████████████████████████████▌                             | 6629/9741 [00:14<00:06, 512.18it/s] 69%|███████████████████████████████████████████████████████████████                             | 6681/9741 [00:14<00:05, 510.98it/s] 69%|███████████████████████████████████████████████████████████████▌                            | 6734/9741 [00:14<00:05, 514.00it/s] 70%|████████████████████████████████████████████████████████████████                            | 6786/9741 [00:14<00:05, 514.28it/s] 70%|████████████████████████████████████████████████████████████████▌                           | 6839/9741 [00:14<00:05, 516.60it/s] 71%|█████████████████████████████████████████████████████████████████                           | 6891/9741 [00:14<00:05, 511.81it/s] 71%|█████████████████████████████████████████████████████████████████▌                          | 6943/9741 [00:14<00:05, 511.10it/s] 72%|██████████████████████████████████████████████████████████████████                          | 6995/9741 [00:14<00:05, 510.83it/s] 72%|██████████████████████████████████████████████████████████████████▌                         | 7048/9741 [00:14<00:05, 513.88it/s] 73%|███████████████████████████████████████████████████████████████████                         | 7101/9741 [00:14<00:05, 516.30it/s] 73%|███████████████████████████████████████████████████████████████████▌                        | 7154/9741 [00:15<00:04, 518.22it/s] 74%|████████████████████████████████████████████████████████████████████                        | 7207/9741 [00:15<00:04, 518.98it/s] 75%|████████████████████████████████████████████████████████████████████▌                       | 7259/9741 [00:15<00:04, 505.81it/s] 75%|█████████████████████████████████████████████████████████████████████                       | 7312/9741 [00:15<00:04, 510.56it/s] 76%|█████████████████████████████████████████████████████████████████████▌                      | 7365/9741 [00:15<00:04, 513.75it/s] 76%|██████████████████████████████████████████████████████████████████████                      | 7418/9741 [00:15<00:04, 516.17it/s] 77%|██████████████████████████████████████████████████████████████████████▌                     | 7470/9741 [00:15<00:04, 485.60it/s] 77%|███████████████████████████████████████████████████████████████████████                     | 7522/9741 [00:15<00:04, 495.05it/s] 78%|███████████████████████████████████████████████████████████████████████▌                    | 7572/9741 [00:15<00:04, 495.03it/s] 78%|███████████████████████████████████████████████████████████████████████▉                    | 7622/9741 [00:15<00:04, 494.39it/s] 79%|████████████████████████████████████████████████████████████████████████▍                   | 7673/9741 [00:16<00:04, 497.55it/s] 79%|████████████████████████████████████████████████████████████████████████▉                   | 7726/9741 [00:16<00:03, 504.33it/s] 80%|█████████████████████████████████████████████████████████████████████████▍                  | 7778/9741 [00:16<00:03, 508.56it/s] 80%|█████████████████████████████████████████████████████████████████████████▉                  | 7831/9741 [00:16<00:03, 512.05it/s] 81%|██████████████████████████████████████████████████████████████████████████▍                 | 7883/9741 [00:16<00:03, 514.07it/s] 81%|██████████████████████████████████████████████████████████████████████████▉                 | 7935/9741 [00:16<00:03, 502.70it/s] 82%|███████████████████████████████████████████████████████████████████████████▍                | 7988/9741 [00:16<00:03, 507.87it/s] 83%|███████████████████████████████████████████████████████████████████████████▉                | 8041/9741 [00:16<00:03, 511.67it/s] 83%|████████████████████████████████████████████████████████████████████████████▍               | 8094/9741 [00:16<00:03, 514.29it/s] 84%|████████████████████████████████████████████████████████████████████████████▉               | 8146/9741 [00:16<00:03, 513.90it/s] 84%|█████████████████████████████████████████████████████████████████████████████▍              | 8198/9741 [00:17<00:02, 515.58it/s] 85%|█████████████████████████████████████████████████████████████████████████████▉              | 8250/9741 [00:17<00:02, 516.67it/s] 85%|██████████████████████████████████████████████████████████████████████████████▍             | 8302/9741 [00:17<00:02, 506.46it/s] 86%|██████████████████████████████████████████████████████████████████████████████▉             | 8354/9741 [00:17<00:02, 507.72it/s] 86%|███████████████████████████████████████████████████████████████████████████████▍            | 8405/9741 [00:17<00:02, 506.90it/s] 87%|███████████████████████████████████████████████████████████████████████████████▊            | 8457/9741 [00:17<00:02, 510.16it/s] 87%|████████████████████████████████████████████████████████████████████████████████▎           | 8509/9741 [00:17<00:02, 511.36it/s] 88%|████████████████████████████████████████████████████████████████████████████████▊           | 8561/9741 [00:17<00:02, 513.48it/s] 88%|█████████████████████████████████████████████████████████████████████████████████▎          | 8613/9741 [00:17<00:02, 512.66it/s] 89%|█████████████████████████████████████████████████████████████████████████████████▊          | 8665/9741 [00:18<00:02, 503.70it/s] 89%|██████████████████████████████████████████████████████████████████████████████████▎         | 8717/9741 [00:18<00:02, 508.38it/s] 90%|██████████████████████████████████████████████████████████████████████████████████▊         | 8769/9741 [00:18<00:01, 511.42it/s] 91%|███████████████████████████████████████████████████████████████████████████████████▎        | 8821/9741 [00:18<00:01, 511.57it/s] 91%|███████████████████████████████████████████████████████████████████████████████████▊        | 8873/9741 [00:18<00:01, 513.82it/s] 92%|████████████████████████████████████████████████████████████████████████████████████▎       | 8926/9741 [00:18<00:01, 515.75it/s] 92%|████████████████████████████████████████████████████████████████████████████████████▊       | 8978/9741 [00:18<00:01, 512.69it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████▎      | 9030/9741 [00:18<00:01, 507.99it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████▊      | 9082/9741 [00:18<00:01, 509.25it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████▎     | 9134/9741 [00:18<00:01, 512.12it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████▊     | 9186/9741 [00:19<00:01, 514.23it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████▎    | 9239/9741 [00:19<00:00, 515.99it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████▋    | 9291/9741 [00:19<00:00, 514.64it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████▏   | 9343/9741 [00:19<00:00, 505.04it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████▋   | 9395/9741 [00:19<00:00, 509.21it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████▏  | 9447/9741 [00:19<00:00, 512.12it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████▋  | 9499/9741 [00:19<00:00, 511.79it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████▏ | 9551/9741 [00:19<00:00, 510.31it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████▋ | 9603/9741 [00:19<00:00, 512.11it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████▏| 9655/9741 [00:19<00:00, 514.04it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████▋| 9707/9741 [00:20<00:00, 505.17it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:20<00:00, 484.26it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.48s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.17s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.53s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:06<00:12,  6.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.48s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.08s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.47s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:12<00:06,  6.47s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]
[2023-08-07 21:42:22,592] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:13<00:00,  4.66s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.88s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  5.96s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:18<00:00,  6.10s/it]
[2023-08-07 21:42:40,510] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 21:42:40,511] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 21:42:40,511] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 21:42:40,511] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 21:42:40,511] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 21:42:40,511] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f830413d1f0>
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 21:42:40,512] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f830413ddc0>
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 21:42:40,513] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 21:42:40,514] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 21:42:40,514] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 21:42:40,514] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 21:42:40,514] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5029993057250977 seconds
Loading extension module utils...
Time to load utils op: 0.404296875 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]Loading extension module utils...
Time to load utils op: 0.40439534187316895 seconds
############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Rationales: The question is asking how much the family would receive if they recycle 144 cans and 20 kilograms of newspapers. They receive $0.50 for every 12 cans and $1.50 for every 5 kilograms of newspapers. 

First calculate how many sets of 12 cans the family collected, this is done by dividing the total number of cans by 12.
144/12 = 12 sets of 12 cans 

They receive $0.50 for each set of 12 cans so multiply $0.50 by the number of sets to find the total amount for the cans.
$0.50 x 12 = $6

Next calculate how many sets of 5 kilograms of newspapers the family collected, this done by dividing the total kilograms of newspapers by 5.
20/5 = 4 sets of 5 kilograms of newspapers 

They get $1.50 for each set of 5 kilograms of newspapers so multiply $1.50 by the number of sets to find the total amount for the newspapers.
$1.50 x 4 = $6

Finally add the amount from the cans to the amount from the newspapers to find the total amount the family would receive.
$6 + $6 = $12 

The family would receive a total of $12.
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Rationales: Step 1: The problem states that Matthew picked 20 more strawberries than Betty. Since Betty picked 16 strawberries, Matthew picked 16 (the number of strawberries Betty picked) + 20 = 36 strawberries.

Step 2: The problem also states that Matthew picked twice as many strawberries as Natalie. Therefore, Natalie picked 36 (the number of strawberries Matthew picked) / 2 = 18 strawberries.

Step 3: To find out how many strawberries they picked in total, the numbers of strawberries picked by Betty, Matthew, and Natalie are added together, resulting in 16 + 36 + 18 = 70 strawberries.

Step 4: According to the problem, one jar of jam required 7 strawberries. Therefore, they could make 70 (the total number of strawberries picked) / 7 (the number of strawberries required per jar) = 10 jars of jam.

Step 5: The question states that each jar of jam was sold at $4. Therefore, they earned 10 (the total number of jam jars produced) * $4 (the price per jar) = $40 from selling the jars of jam. 

Answer: They were able to make $40 from the strawberries they picked.
Answer: 40

Input: Jack has a stack of books that is 12 inches thick. He knows from experience that 80 pages is one inch thick. If he has 6 books, how many pages is each one on average?
Rationales: Step 1: Determine the total number of pages in the stack. Since Jack knows that 80 pages is one inch thick, and his stack of books is 12 inches thick, he can multiply these two values to find the total number of pages. So, 80 pages/inch * 12 inches = 960 pages.
 
Step 2: Determine the average number of pages per book. Since Jack has 6 books, he can divide the total number of pages by the number of books to find the average number of pages per book. So, 960 pages / 6 books = 160 pages/book.

Therefore, on average, each book has 160 pages.
Answer: 160

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s42-rTrue
Loading extension module utils...
Time to load utils op: 0.504612922668457 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:44<36:10, 44.30s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:28<35:16, 44.09s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [01:54<28:06, 35.88s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [02:38<29:55, 39.03s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [03:13<28:15, 37.67s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [03:51<27:44, 37.82s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [04:35<28:30, 39.77s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [05:19<28:43, 41.03s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [06:02<28:32, 41.78s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [06:46<28:19, 42.48s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [07:30<27:53, 42.91s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [08:14<27:20, 43.17s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [08:58<26:45, 43.40s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [09:41<26:03, 43.43s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [10:24<25:16, 43.33s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [10:49<21:27, 37.86s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [11:33<21:50, 39.70s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [12:17<21:44, 40.77s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [13:01<21:37, 41.86s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [13:45<21:12, 42.43s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [14:29<20:44, 42.93s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [15:13<20:08, 43.16s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [15:56<19:28, 43.29s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [16:40<18:46, 43.31s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [17:24<18:08, 43.52s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [17:38<13:52, 34.70s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [18:22<14:22, 37.49s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [19:05<14:22, 39.22s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [19:49<14:13, 40.66s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [20:36<14:09, 42.46s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [21:20<13:35, 42.90s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [22:03<12:56, 43.13s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [22:48<12:20, 43.57s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [23:32<11:39, 43.74s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [23:56<09:27, 37.85s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [24:41<09:17, 39.85s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [25:25<08:56, 41.24s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [26:09<08:23, 41.95s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [26:54<07:52, 43.00s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [27:38<07:12, 43.29s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [28:22<06:31, 43.48s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [29:07<05:50, 43.85s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [29:52<05:09, 44.24s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [30:36<04:25, 44.21s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [31:01<03:12, 38.52s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [31:40<02:34, 38.53s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [32:25<02:01, 40.50s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [33:10<01:23, 41.78s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [33:54<00:42, 42.45s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [34:38<00:00, 42.91s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [34:38<00:00, 41.56s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 1.6589} | lm_loss 7.946 | avg. gen lenth: 289.636
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s42-rTrue --rationales --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-07 22:18:52,978] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s42-rTrue
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s42-rTrue
  rationales ................... True
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  0%|▎                                                                                             | 28/9741 [00:00<00:35, 272.06it/s]  1%|▌                                                                                             | 56/9741 [00:00<00:35, 272.85it/s]  1%|▊                                                                                             | 84/9741 [00:00<00:37, 258.75it/s]  1%|█                                                                                            | 112/9741 [00:00<00:36, 265.28it/s]  1%|█▎                                                                                           | 139/9741 [00:00<00:36, 261.81it/s]  2%|█▌                                                                                           | 166/9741 [00:00<00:36, 260.98it/s]  2%|█▊                                                                                           | 193/9741 [00:00<00:36, 259.04it/s]  2%|██                                                                                           | 220/9741 [00:00<00:36, 260.37it/s]  3%|██▎                                                                                          | 248/9741 [00:00<00:35, 264.08it/s]  3%|██▋                                                                                          | 276/9741 [00:01<00:35, 266.74it/s]  3%|██▉                                                                                          | 304/9741 [00:01<00:35, 268.80it/s]  3%|███▏                                                                                         | 331/9741 [00:01<00:36, 260.77it/s]  4%|███▍                                                                                         | 358/9741 [00:01<00:35, 262.36it/s]  4%|███▋                                                                                         | 386/9741 [00:01<00:35, 265.52it/s]  4%|███▉                                                                                         | 414/9741 [00:01<00:34, 266.94it/s]  5%|████▏                                                                                        | 441/9741 [00:01<00:34, 266.59it/s]  5%|████▍                                                                                        | 468/9741 [00:01<00:34, 266.01it/s]  5%|████▋                                                                                        | 496/9741 [00:01<00:34, 267.81it/s]  5%|████▉                                                                                        | 523/9741 [00:01<00:34, 267.87it/s]  6%|█████▎                                                                                       | 550/9741 [00:02<00:35, 257.46it/s]  6%|█████▌                                                                                       | 578/9741 [00:02<00:35, 261.59it/s]  6%|█████▊                                                                                       | 606/9741 [00:02<00:34, 264.57it/s]  7%|██████                                                                                       | 634/9741 [00:02<00:34, 266.68it/s]  7%|██████▎                                                                                      | 661/9741 [00:02<00:34, 266.90it/s]  7%|██████▌                                                                                      | 689/9741 [00:02<00:33, 268.66it/s]  7%|██████▊                                                                                      | 717/9741 [00:02<00:33, 269.39it/s]  8%|███████                                                                                      | 744/9741 [00:02<00:34, 258.65it/s]  8%|███████▎                                                                                     | 772/9741 [00:02<00:34, 262.45it/s]  8%|███████▋                                                                                     | 800/9741 [00:03<00:33, 264.93it/s]  9%|███████▉                                                                                     | 828/9741 [00:03<00:33, 267.17it/s]  9%|████████▏                                                                                    | 856/9741 [00:03<00:33, 268.82it/s]  9%|████████▍                                                                                    | 884/9741 [00:03<00:32, 270.03it/s]  9%|████████▋                                                                                    | 912/9741 [00:03<00:32, 268.76it/s] 10%|████████▉                                                                                    | 939/9741 [00:03<00:33, 265.08it/s] 10%|█████████▎                                                                                   | 969/9741 [00:03<00:31, 275.21it/s] 10%|█████████▌                                                                                  | 1009/9741 [00:03<00:28, 311.03it/s] 11%|█████████▉                                                                                  | 1051/9741 [00:03<00:25, 340.83it/s] 11%|██████████▎                                                                                 | 1093/9741 [00:03<00:23, 362.57it/s] 12%|██████████▋                                                                                 | 1134/9741 [00:04<00:22, 375.44it/s] 12%|███████████                                                                                 | 1176/9741 [00:04<00:22, 386.56it/s] 13%|███████████▌                                                                                | 1218/9741 [00:04<00:21, 394.36it/s] 13%|███████████▉                                                                                | 1258/9741 [00:04<00:22, 370.56it/s] 13%|████████████▎                                                                               | 1299/9741 [00:04<00:22, 381.27it/s] 14%|████████████▋                                                                               | 1340/9741 [00:04<00:21, 387.19it/s] 14%|█████████████                                                                               | 1381/9741 [00:04<00:21, 393.70it/s] 15%|█████████████▍                                                                              | 1423/9741 [00:04<00:20, 400.01it/s] 15%|█████████████▊                                                                              | 1465/9741 [00:04<00:20, 404.40it/s] 15%|██████████████▏                                                                             | 1507/9741 [00:04<00:20, 407.67it/s] 16%|██████████████▌                                                                             | 1548/9741 [00:05<00:20, 390.71it/s] 16%|███████████████                                                                             | 1589/9741 [00:05<00:20, 394.61it/s] 17%|███████████████▍                                                                            | 1631/9741 [00:05<00:20, 400.30it/s] 17%|███████████████▊                                                                            | 1673/9741 [00:05<00:19, 404.46it/s] 18%|████████████████▏                                                                           | 1715/9741 [00:05<00:19, 407.52it/s] 18%|████████████████▌                                                                           | 1756/9741 [00:05<00:19, 406.91it/s] 18%|████████████████▉                                                                           | 1797/9741 [00:05<00:20, 380.72it/s] 19%|█████████████████▎                                                                          | 1836/9741 [00:05<00:21, 369.74it/s] 19%|█████████████████▋                                                                          | 1878/9741 [00:05<00:20, 381.84it/s] 20%|██████████████████▏                                                                         | 1920/9741 [00:06<00:20, 390.60it/s] 20%|██████████████████▌                                                                         | 1962/9741 [00:06<00:19, 397.48it/s] 21%|██████████████████▉                                                                         | 2004/9741 [00:06<00:19, 402.85it/s] 21%|███████████████████▎                                                                        | 2045/9741 [00:06<00:19, 403.66it/s] 21%|███████████████████▋                                                                        | 2086/9741 [00:06<00:19, 400.33it/s] 22%|████████████████████                                                                        | 2127/9741 [00:06<00:19, 391.79it/s] 22%|████████████████████▍                                                                       | 2168/9741 [00:06<00:19, 395.78it/s] 23%|████████████████████▊                                                                       | 2210/9741 [00:06<00:18, 401.49it/s] 23%|█████████████████████▎                                                                      | 2251/9741 [00:06<00:18, 403.10it/s] 24%|█████████████████████▋                                                                      | 2292/9741 [00:06<00:18, 402.74it/s] 24%|██████████████████████                                                                      | 2333/9741 [00:07<00:18, 403.94it/s] 24%|██████████████████████▍                                                                     | 2374/9741 [00:07<00:18, 401.56it/s] 25%|██████████████████████▊                                                                     | 2415/9741 [00:07<00:18, 386.96it/s] 25%|███████████████████████▏                                                                    | 2457/9741 [00:07<00:18, 394.49it/s] 26%|███████████████████████▌                                                                    | 2498/9741 [00:07<00:18, 397.51it/s] 26%|███████████████████████▉                                                                    | 2540/9741 [00:07<00:17, 401.87it/s] 27%|████████████████████████▍                                                                   | 2582/9741 [00:07<00:17, 405.66it/s] 27%|████████████████████████▊                                                                   | 2623/9741 [00:07<00:17, 402.74it/s] 27%|█████████████████████████▏                                                                  | 2665/9741 [00:07<00:17, 406.32it/s] 28%|█████████████████████████▌                                                                  | 2706/9741 [00:07<00:17, 406.12it/s] 28%|█████████████████████████▉                                                                  | 2747/9741 [00:08<00:17, 390.29it/s] 29%|██████████████████████████▎                                                                 | 2788/9741 [00:08<00:17, 395.86it/s] 29%|██████████████████████████▋                                                                 | 2830/9741 [00:08<00:17, 400.78it/s] 29%|███████████████████████████                                                                 | 2871/9741 [00:08<00:17, 401.22it/s] 30%|███████████████████████████▌                                                                | 2912/9741 [00:08<00:16, 402.69it/s] 30%|███████████████████████████▉                                                                | 2953/9741 [00:08<00:16, 403.51it/s] 31%|████████████████████████████▎                                                               | 2995/9741 [00:08<00:16, 406.78it/s] 31%|████████████████████████████▋                                                               | 3036/9741 [00:08<00:17, 390.65it/s] 32%|█████████████████████████████                                                               | 3078/9741 [00:08<00:16, 396.97it/s] 32%|█████████████████████████████▍                                                              | 3120/9741 [00:09<00:16, 402.19it/s] 32%|█████████████████████████████▊                                                              | 3161/9741 [00:09<00:16, 396.45it/s] 33%|██████████████████████████████▎                                                             | 3203/9741 [00:09<00:16, 402.08it/s] 33%|██████████████████████████████▋                                                             | 3245/9741 [00:09<00:16, 405.30it/s] 34%|███████████████████████████████                                                             | 3287/9741 [00:09<00:15, 407.86it/s] 34%|███████████████████████████████▍                                                            | 3328/9741 [00:09<00:16, 391.42it/s] 35%|███████████████████████████████▊                                                            | 3370/9741 [00:09<00:16, 397.50it/s] 35%|████████████████████████████████▏                                                           | 3410/9741 [00:09<00:15, 396.70it/s] 35%|████████████████████████████████▌                                                           | 3450/9741 [00:09<00:15, 397.04it/s] 36%|████████████████████████████████▉                                                           | 3492/9741 [00:09<00:15, 401.35it/s] 36%|█████████████████████████████████▎                                                          | 3533/9741 [00:10<00:15, 403.52it/s] 37%|█████████████████████████████████▊                                                          | 3575/9741 [00:10<00:15, 405.56it/s] 37%|██████████████████████████████████▏                                                         | 3616/9741 [00:10<00:15, 384.93it/s] 38%|██████████████████████████████████▌                                                         | 3658/9741 [00:10<00:15, 392.79it/s] 38%|██████████████████████████████████▉                                                         | 3698/9741 [00:10<00:15, 392.99it/s] 38%|███████████████████████████████████▎                                                        | 3740/9741 [00:10<00:15, 399.15it/s] 39%|███████████████████████████████████▋                                                        | 3782/9741 [00:10<00:14, 403.28it/s] 39%|████████████████████████████████████                                                        | 3824/9741 [00:10<00:14, 405.88it/s] 40%|████████████████████████████████████▌                                                       | 3865/9741 [00:10<00:14, 405.76it/s] 40%|████████████████████████████████████▉                                                       | 3906/9741 [00:11<00:14, 389.44it/s] 41%|█████████████████████████████████████▎                                                      | 3948/9741 [00:11<00:14, 396.23it/s] 41%|█████████████████████████████████████▋                                                      | 3988/9741 [00:11<00:14, 394.87it/s] 41%|██████████████████████████████████████                                                      | 4030/9741 [00:11<00:14, 400.51it/s] 42%|██████████████████████████████████████▍                                                     | 4071/9741 [00:11<00:14, 402.62it/s] 42%|██████████████████████████████████████▊                                                     | 4113/9741 [00:11<00:13, 405.59it/s] 43%|███████████████████████████████████████▏                                                    | 4155/9741 [00:11<00:13, 407.59it/s] 43%|███████████████████████████████████████▋                                                    | 4197/9741 [00:11<00:13, 408.30it/s] 44%|████████████████████████████████████████                                                    | 4238/9741 [00:11<00:14, 385.84it/s] 44%|████████████████████████████████████████▍                                                   | 4279/9741 [00:11<00:13, 391.97it/s] 44%|████████████████████████████████████████▊                                                   | 4320/9741 [00:12<00:13, 395.17it/s] 45%|█████████████████████████████████████████▏                                                  | 4362/9741 [00:12<00:13, 400.18it/s] 45%|█████████████████████████████████████████▌                                                  | 4404/9741 [00:12<00:13, 404.09it/s] 46%|█████████████████████████████████████████▉                                                  | 4446/9741 [00:12<00:13, 406.21it/s] 46%|██████████████████████████████████████████▍                                                 | 4488/9741 [00:12<00:12, 408.45it/s] 46%|██████████████████████████████████████████▊                                                 | 4529/9741 [00:12<00:14, 361.88it/s] 47%|███████████████████████████████████████████▏                                                | 4571/9741 [00:12<00:13, 375.94it/s] 47%|███████████████████████████████████████████▌                                                | 4613/9741 [00:12<00:13, 385.97it/s] 48%|███████████████████████████████████████████▉                                                | 4655/9741 [00:12<00:12, 393.45it/s] 48%|████████████████████████████████████████████▎                                               | 4697/9741 [00:13<00:12, 398.96it/s] 49%|████████████████████████████████████████████▊                                               | 4739/9741 [00:13<00:12, 403.49it/s] 49%|█████████████████████████████████████████████▏                                              | 4780/9741 [00:13<00:17, 282.61it/s] 50%|█████████████████████████████████████████████▌                                              | 4822/9741 [00:13<00:15, 312.07it/s] 50%|█████████████████████████████████████████████▉                                              | 4864/9741 [00:13<00:14, 336.41it/s] 50%|██████████████████████████████████████████████▎                                             | 4906/9741 [00:13<00:13, 356.35it/s] 51%|██████████████████████████████████████████████▋                                             | 4947/9741 [00:13<00:12, 370.16it/s] 51%|███████████████████████████████████████████████                                             | 4989/9741 [00:13<00:12, 382.13it/s] 52%|███████████████████████████████████████████████▍                                            | 5029/9741 [00:13<00:12, 375.16it/s] 52%|███████████████████████████████████████████████▊                                            | 5068/9741 [00:14<00:12, 367.02it/s] 52%|████████████████████████████████████████████████▎                                           | 5110/9741 [00:14<00:12, 379.95it/s] 53%|████████████████████████████████████████████████▋                                           | 5151/9741 [00:14<00:11, 388.20it/s] 53%|█████████████████████████████████████████████████                                           | 5192/9741 [00:14<00:11, 392.76it/s] 54%|█████████████████████████████████████████████████▍                                          | 5234/9741 [00:14<00:11, 398.72it/s] 54%|█████████████████████████████████████████████████▊                                          | 5275/9741 [00:14<00:11, 385.65it/s] 55%|██████████████████████████████████████████████████▏                                         | 5317/9741 [00:14<00:11, 393.67it/s] 55%|██████████████████████████████████████████████████▌                                         | 5357/9741 [00:14<00:11, 381.13it/s] 55%|██████████████████████████████████████████████████▉                                         | 5398/9741 [00:14<00:11, 389.08it/s] 56%|███████████████████████████████████████████████████▎                                        | 5439/9741 [00:15<00:10, 393.37it/s] 56%|███████████████████████████████████████████████████▊                                        | 5481/9741 [00:15<00:10, 399.75it/s] 57%|████████████████████████████████████████████████████▏                                       | 5524/9741 [00:15<00:10, 407.44it/s] 57%|████████████████████████████████████████████████████▌                                       | 5565/9741 [00:15<00:10, 408.00it/s] 58%|████████████████████████████████████████████████████▉                                       | 5608/9741 [00:15<00:10, 412.88it/s] 58%|█████████████████████████████████████████████████████▎                                      | 5650/9741 [00:15<00:10, 398.25it/s] 58%|█████████████████████████████████████████████████████▊                                      | 5693/9741 [00:15<00:09, 406.34it/s] 59%|██████████████████████████████████████████████████████▏                                     | 5736/9741 [00:15<00:09, 412.22it/s] 59%|██████████████████████████████████████████████████████▌                                     | 5779/9741 [00:15<00:09, 416.22it/s] 60%|██████████████████████████████████████████████████████▉                                     | 5822/9741 [00:15<00:09, 418.80it/s] 60%|███████████████████████████████████████████████████████▍                                    | 5864/9741 [00:16<00:09, 414.42it/s] 61%|███████████████████████████████████████████████████████▊                                    | 5907/9741 [00:16<00:09, 418.09it/s] 61%|████████████████████████████████████████████████████████▏                                   | 5949/9741 [00:16<00:09, 398.50it/s] 62%|████████████████████████████████████████████████████████▌                                   | 5992/9741 [00:16<00:09, 406.23it/s] 62%|████████████████████████████████████████████████████████▉                                   | 6034/9741 [00:16<00:09, 409.55it/s] 62%|█████████████████████████████████████████████████████████▍                                  | 6077/9741 [00:16<00:08, 414.70it/s] 63%|█████████████████████████████████████████████████████████▊                                  | 6119/9741 [00:16<00:08, 412.03it/s] 63%|██████████████████████████████████████████████████████████▏                                 | 6161/9741 [00:16<00:08, 413.02it/s] 64%|██████████████████████████████████████████████████████████▌                                 | 6204/9741 [00:16<00:08, 417.03it/s] 64%|██████████████████████████████████████████████████████████▉                                 | 6246/9741 [00:16<00:08, 399.32it/s] 65%|███████████████████████████████████████████████████████████▍                                | 6289/9741 [00:17<00:08, 406.01it/s] 65%|███████████████████████████████████████████████████████████▊                                | 6331/9741 [00:17<00:08, 409.44it/s] 65%|████████████████████████████████████████████████████████████▏                               | 6374/9741 [00:17<00:08, 414.59it/s] 66%|████████████████████████████████████████████████████████████▌                               | 6416/9741 [00:17<00:08, 412.81it/s] 66%|█████████████████████████████████████████████████████████████                               | 6459/9741 [00:17<00:07, 416.60it/s] 67%|█████████████████████████████████████████████████████████████▍                              | 6502/9741 [00:17<00:07, 419.43it/s] 67%|█████████████████████████████████████████████████████████████▊                              | 6544/9741 [00:17<00:07, 419.08it/s] 68%|██████████████████████████████████████████████████████████████▏                             | 6586/9741 [00:17<00:07, 399.47it/s] 68%|██████████████████████████████████████████████████████████████▌                             | 6629/9741 [00:17<00:07, 406.47it/s] 68%|███████████████████████████████████████████████████████████████                             | 6672/9741 [00:18<00:07, 411.78it/s] 69%|███████████████████████████████████████████████████████████████▍                            | 6714/9741 [00:18<00:07, 409.17it/s] 69%|███████████████████████████████████████████████████████████████▊                            | 6757/9741 [00:18<00:07, 414.28it/s] 70%|████████████████████████████████████████████████████████████████▏                           | 6799/9741 [00:18<00:07, 415.77it/s] 70%|████████████████████████████████████████████████████████████████▌                           | 6841/9741 [00:18<00:06, 416.00it/s] 71%|█████████████████████████████████████████████████████████████████                           | 6883/9741 [00:18<00:07, 397.01it/s] 71%|█████████████████████████████████████████████████████████████████▍                          | 6926/9741 [00:18<00:06, 404.67it/s] 72%|█████████████████████████████████████████████████████████████████▊                          | 6967/9741 [00:18<00:06, 402.60it/s] 72%|██████████████████████████████████████████████████████████████████▏                         | 7009/9741 [00:18<00:06, 406.98it/s] 72%|██████████████████████████████████████████████████████████████████▌                         | 7052/9741 [00:18<00:06, 412.74it/s] 73%|███████████████████████████████████████████████████████████████████                         | 7095/9741 [00:19<00:06, 416.55it/s] 73%|███████████████████████████████████████████████████████████████████▍                        | 7138/9741 [00:19<00:06, 419.41it/s] 74%|███████████████████████████████████████████████████████████████████▊                        | 7180/9741 [00:19<00:06, 406.41it/s] 74%|████████████████████████████████████████████████████████████████████▏                       | 7221/9741 [00:19<00:06, 400.64it/s] 75%|████████████████████████████████████████████████████████████████████▌                       | 7262/9741 [00:19<00:06, 402.09it/s] 75%|████████████████████████████████████████████████████████████████████▉                       | 7305/9741 [00:19<00:05, 408.81it/s] 75%|█████████████████████████████████████████████████████████████████████▍                      | 7348/9741 [00:19<00:05, 413.81it/s] 76%|█████████████████████████████████████████████████████████████████████▊                      | 7391/9741 [00:19<00:05, 417.31it/s] 76%|██████████████████████████████████████████████████████████████████████▏                     | 7434/9741 [00:19<00:05, 419.74it/s] 77%|██████████████████████████████████████████████████████████████████████▌                     | 7476/9741 [00:19<00:05, 394.04it/s] 77%|██████████████████████████████████████████████████████████████████████▉                     | 7516/9741 [00:20<00:05, 374.53it/s] 78%|███████████████████████████████████████████████████████████████████████▍                    | 7559/9741 [00:20<00:05, 388.16it/s] 78%|███████████████████████████████████████████████████████████████████████▊                    | 7602/9741 [00:20<00:05, 398.50it/s] 78%|████████████████████████████████████████████████████████████████████████▏                   | 7645/9741 [00:20<00:05, 406.18it/s] 79%|████████████████████████████████████████████████████████████████████████▌                   | 7687/9741 [00:20<00:05, 409.32it/s] 79%|█████████████████████████████████████████████████████████████████████████                   | 7730/9741 [00:20<00:04, 414.46it/s] 80%|█████████████████████████████████████████████████████████████████████████▍                  | 7772/9741 [00:20<00:05, 391.17it/s] 80%|█████████████████████████████████████████████████████████████████████████▊                  | 7815/9741 [00:20<00:04, 400.04it/s] 81%|██████████████████████████████████████████████████████████████████████████▏                 | 7858/9741 [00:20<00:04, 407.20it/s] 81%|██████████████████████████████████████████████████████████████████████████▌                 | 7900/9741 [00:21<00:04, 410.51it/s] 82%|███████████████████████████████████████████████████████████████████████████                 | 7943/9741 [00:21<00:04, 414.85it/s] 82%|███████████████████████████████████████████████████████████████████████████▍                | 7986/9741 [00:21<00:04, 417.55it/s] 82%|███████████████████████████████████████████████████████████████████████████▊                | 8029/9741 [00:21<00:04, 419.78it/s] 83%|████████████████████████████████████████████████████████████████████████████▏               | 8072/9741 [00:21<00:04, 390.81it/s] 83%|████████████████████████████████████████████████████████████████████████████▌               | 8113/9741 [00:21<00:04, 395.17it/s] 84%|█████████████████████████████████████████████████████████████████████████████               | 8155/9741 [00:21<00:03, 401.47it/s] 84%|█████████████████████████████████████████████████████████████████████████████▍              | 8198/9741 [00:21<00:03, 408.33it/s] 85%|█████████████████████████████████████████████████████████████████████████████▊              | 8240/9741 [00:21<00:03, 409.61it/s] 85%|██████████████████████████████████████████████████████████████████████████████▏             | 8283/9741 [00:21<00:03, 413.76it/s] 85%|██████████████████████████████████████████████████████████████████████████████▋             | 8325/9741 [00:22<00:03, 402.59it/s] 86%|███████████████████████████████████████████████████████████████████████████████             | 8367/9741 [00:22<00:03, 406.22it/s] 86%|███████████████████████████████████████████████████████████████████████████████▍            | 8408/9741 [00:22<00:03, 390.17it/s] 87%|███████████████████████████████████████████████████████████████████████████████▊            | 8451/9741 [00:22<00:03, 399.28it/s] 87%|████████████████████████████████████████████████████████████████████████████████▏           | 8494/9741 [00:22<00:03, 406.02it/s] 88%|████████████████████████████████████████████████████████████████████████████████▋           | 8537/9741 [00:22<00:02, 411.17it/s] 88%|█████████████████████████████████████████████████████████████████████████████████           | 8579/9741 [00:22<00:02, 398.26it/s] 89%|█████████████████████████████████████████████████████████████████████████████████▍          | 8622/9741 [00:22<00:02, 405.31it/s] 89%|█████████████████████████████████████████████████████████████████████████████████▊          | 8665/9741 [00:22<00:02, 410.50it/s] 89%|██████████████████████████████████████████████████████████████████████████████████▏         | 8707/9741 [00:23<00:02, 396.32it/s] 90%|██████████████████████████████████████████████████████████████████████████████████▋         | 8750/9741 [00:23<00:02, 403.64it/s] 90%|███████████████████████████████████████████████████████████████████████████████████         | 8793/9741 [00:23<00:02, 409.27it/s] 91%|███████████████████████████████████████████████████████████████████████████████████▍        | 8835/9741 [00:23<00:02, 404.44it/s] 91%|███████████████████████████████████████████████████████████████████████████████████▊        | 8876/9741 [00:23<00:02, 400.67it/s] 92%|████████████████████████████████████████████████████████████████████████████████████▏       | 8918/9741 [00:23<00:02, 403.66it/s] 92%|████████████████████████████████████████████████████████████████████████████████████▋       | 8961/9741 [00:23<00:01, 409.19it/s] 92%|█████████████████████████████████████████████████████████████████████████████████████       | 9002/9741 [00:23<00:01, 392.07it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████▍      | 9044/9741 [00:23<00:01, 398.68it/s] 93%|█████████████████████████████████████████████████████████████████████████████████████▊      | 9087/9741 [00:23<00:01, 405.86it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████▏     | 9128/9741 [00:24<00:01, 395.47it/s] 94%|██████████████████████████████████████████████████████████████████████████████████████▌     | 9171/9741 [00:24<00:01, 403.59it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████     | 9214/9741 [00:24<00:01, 409.17it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████▍    | 9257/9741 [00:24<00:01, 413.48it/s] 95%|███████████████████████████████████████████████████████████████████████████████████████▊    | 9299/9741 [00:24<00:01, 395.45it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████▏   | 9342/9741 [00:24<00:00, 402.59it/s] 96%|████████████████████████████████████████████████████████████████████████████████████████▌   | 9383/9741 [00:24<00:00, 404.28it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████   | 9424/9741 [00:24<00:00, 397.36it/s] 97%|█████████████████████████████████████████████████████████████████████████████████████████▍  | 9467/9741 [00:24<00:00, 404.78it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████▊  | 9509/9741 [00:25<00:00, 408.30it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████▏ | 9552/9741 [00:25<00:00, 412.84it/s] 98%|██████████████████████████████████████████████████████████████████████████████████████████▌ | 9594/9741 [00:25<00:00, 396.33it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████ | 9637/9741 [00:25<00:00, 403.45it/s] 99%|███████████████████████████████████████████████████████████████████████████████████████████▍| 9678/9741 [00:25<00:00, 394.23it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████▊| 9720/9741 [00:25<00:00, 400.48it/s]100%|████████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:25<00:00, 380.31it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.58s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:06<00:12,  6.38s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:06<00:13,  6.56s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.26s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.45s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.82s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:13<00:06,  6.58s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.18s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.83s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.01s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.02s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.31s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.60s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]
[2023-08-07 22:20:14,678] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.57s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:19<00:00,  6.56s/it]
[2023-08-07 22:20:33,074] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 22:20:33,075] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 22:20:33,076] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f34a872a1f0>
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 22:20:33,077] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f34a872adc0>
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 22:20:33,078] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 22:20:33,078] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.4845612049102783 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Rationales: The first step to solve this problem is to determine how many groups there are for each recycled material. The family collected 144 cans, and since they get $0.50 for every 12 cans recycled, we need to find out how many complete sets of 12 cans they have. Dividing 144 cans by 12, we find that there are 12 sets.

Next, we need to find out how much the family will receive for recycling these cans. Multiplying the 12 sets by the $0.50 they receive for each set, we find that the family will receive $6 for the cans.

Secondly, the family also collected 20 kilograms of newspapers. Since they receive $1.50 for every 5 kilograms of newspapers, we need to determine how many complete sets of 5 kilograms they have. Dividing 20 kilograms by 5, we find that there are 4 sets.

We then need to find out how much the family will receive for recycling these newspapers. Multiplying the 4 sets by the $1.50 they receive for each set, we find that the family will receive $6 for the newspapers.

Finally, to find out how much money in total the family will receive, we add the money received for the cans and the newspapers together. Adding $6 and $6, we find that the family will receive $12 in total.
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Rationales: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty which means Matthew picked 16 + 20 = 36 strawberries.
Matthew also picked twice as many strawberries as Natalie. This means Natalie picked 36/2 = 18 strawberries.
Adding up the number of strawberries picked by each person, we get 16 (Betty) + 36 (Matthew) + 18 (Natalie) = 70 strawberries in total.
They used these strawberries to make jam, with each jar of jam requiring 7 strawberries. This means they can make 70/7 = 10 jars of strawberries.
Finally, they sold each jar at $4. So, they were able to make 10 x $4 = $40 from the strawberries they picked. Therefore, they were able to make $40 from the strawberries.
Answer: 40

Input: Jack has a stack of books that is 12 inches thick. He knows from experience that 80 pages is one inch thick. If he has 6 books, how many pages is each one on average?
Rationales: Given:

1. Jack's stack of books is 12 inches thick.

2. 80 pages equals one inch in thickness.

3. Jack has 6 books in total.

Goal: Find out how many pages each book has on average.

Steps:

1. Convert the total thickness of the books in inches to the number of pages. This is done by multiplying the total thickness of the books (12 inches) by the number of pages in an inch (80 pages). So, 80 pages/inch * 12 inches = 960 pages in total.

2. Then, divide the total number of pages (960 pages) by the total number of books (6 books) to find the average number of pages per book. So, 960 pages / 6 books = 160 pages/book on average.

Thus, each book has an average of 160 pages.
Answer: 160

Input: James dumps his whole collection of 500 Legos on the floor and starts building a castle out of them.  He uses half the pieces before finishing and is told to put the rest away.  He puts all of the leftover pieces back in the box they came from, except for 5 missing pieces that he can't find.  How many Legos are in the box at the end?
Rationales: James starts with 500 Legos in his collection. 
First, we need to find out how many Legos he used. Since he used half of his collection, this would be 500 divided by 2, which equals 250 Legos. 
Subtract this number from 500, we get the unused Legos, which is also 250. 
Then, we know that he was missing 5 Lego pieces when he put the Legos away, so we subtract 5 from the unused 250 Legos.
Therefore, the final number of Legos that were put back in the box is 245.
Answer: 245

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s42-rTrue
Loading extension module utils...
Time to load utils op: 0.5047299861907959 seconds
Loading extension module utils...
Loading extension module utils...
Time to load utils op: 0.5048537254333496 seconds
Time to load utils op: 0.5181434154510498 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:43<35:45, 43.78s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:26<34:37, 43.27s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:02<31:16, 39.93s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [02:44<31:19, 40.85s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [03:28<31:14, 41.67s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [03:50<25:51, 35.26s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [04:33<26:58, 37.63s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [05:15<27:24, 39.15s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [05:58<27:29, 40.23s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [06:40<27:15, 40.89s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [07:23<26:56, 41.44s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [08:05<26:22, 41.65s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [08:48<25:51, 41.94s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [09:31<25:21, 42.25s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [10:02<22:41, 38.90s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [10:44<22:37, 39.93s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [11:27<22:27, 40.82s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [12:09<21:58, 41.19s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [12:51<21:23, 41.41s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [13:34<20:53, 41.80s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [14:16<20:20, 42.07s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [14:59<19:43, 42.27s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [15:41<19:02, 42.30s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [16:24<18:18, 42.23s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [17:07<17:41, 42.47s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [17:48<16:54, 42.29s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [18:31<16:16, 42.44s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [19:13<15:32, 42.39s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [19:52<14:28, 41.35s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [20:35<13:53, 41.67s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [21:17<13:17, 41.95s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [22:00<12:36, 42.05s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [22:42<11:57, 42.21s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [23:25<11:17, 42.36s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [24:08<10:38, 42.55s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [24:50<09:53, 42.38s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [25:21<08:27, 39.01s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [25:59<07:42, 38.54s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [26:41<07:17, 39.80s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [27:24<06:45, 40.59s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [28:06<06:08, 40.98s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [28:49<05:32, 41.57s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [29:31<04:52, 41.72s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [30:04<03:56, 39.34s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [30:47<03:21, 40.29s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [31:29<02:43, 40.91s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [32:12<02:04, 41.38s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [32:54<01:23, 41.77s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [33:37<00:42, 42.01s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [34:19<00:00, 42.13s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [34:19<00:00, 41.20s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9246} | lm_loss 7.856 | avg. gen lenth: 280.888
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s42-rFalse --num-out-domain 1
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-07 22:55:36,555] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o1-tgsm8k-s42-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 1
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s42-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  2%|█▊                                                                                          | 192/9741 [00:00<00:04, 1913.14it/s]  4%|███▊                                                                                        | 404/9741 [00:00<00:04, 2033.12it/s]  6%|█████▊                                                                                      | 619/9741 [00:00<00:04, 2085.16it/s]  9%|███████▉                                                                                    | 836/9741 [00:00<00:04, 2118.25it/s] 11%|█████████▊                                                                                 | 1055/9741 [00:00<00:04, 2140.70it/s] 13%|███████████▉                                                                               | 1272/9741 [00:00<00:03, 2148.78it/s] 15%|█████████████▉                                                                             | 1488/9741 [00:00<00:03, 2150.46it/s] 17%|███████████████▉                                                                           | 1704/9741 [00:00<00:03, 2088.77it/s] 20%|█████████████████▉                                                                         | 1914/9741 [00:00<00:03, 2005.59it/s] 22%|███████████████████▊                                                                       | 2127/9741 [00:01<00:03, 2040.93it/s] 24%|█████████████████████▉                                                                     | 2344/9741 [00:01<00:03, 2077.45it/s] 26%|███████████████████████▉                                                                   | 2561/9741 [00:01<00:03, 2104.46it/s] 28%|█████████████████████████▉                                                                 | 2776/9741 [00:01<00:03, 2116.09it/s] 31%|███████████████████████████▉                                                               | 2992/9741 [00:01<00:03, 2128.10it/s] 33%|█████████████████████████████▉                                                             | 3207/9741 [00:01<00:03, 2133.31it/s] 35%|███████████████████████████████▉                                                           | 3421/9741 [00:01<00:03, 2058.66it/s] 37%|█████████████████████████████████▉                                                         | 3628/9741 [00:01<00:02, 2058.71it/s] 39%|███████████████████████████████████▊                                                       | 3836/9741 [00:01<00:02, 2060.82it/s] 42%|█████████████████████████████████████▊                                                     | 4045/9741 [00:01<00:02, 2068.39it/s] 44%|███████████████████████████████████████▋                                                   | 4253/9741 [00:02<00:02, 1930.97it/s] 46%|█████████████████████████████████████████▌                                                 | 4449/9741 [00:02<00:02, 1872.16it/s] 48%|███████████████████████████████████████████▎                                               | 4641/9741 [00:02<00:02, 1884.04it/s] 50%|█████████████████████████████████████████████▏                                             | 4831/9741 [00:02<00:03, 1466.36it/s] 51%|██████████████████████████████████████████████▋                                            | 4993/9741 [00:02<00:03, 1473.01it/s] 53%|████████████████████████████████████████████████                                           | 5151/9741 [00:02<00:03, 1350.67it/s] 55%|█████████████████████████████████████████████████▊                                         | 5332/9741 [00:02<00:03, 1462.39it/s] 57%|███████████████████████████████████████████████████▌                                       | 5526/9741 [00:02<00:02, 1584.65it/s] 59%|█████████████████████████████████████████████████████▌                                     | 5740/9741 [00:03<00:02, 1732.39it/s] 61%|███████████████████████████████████████████████████████▌                                   | 5953/9741 [00:03<00:02, 1842.53it/s] 63%|█████████████████████████████████████████████████████████▍                                 | 6143/9741 [00:03<00:01, 1828.02it/s] 65%|███████████████████████████████████████████████████████████▍                               | 6366/9741 [00:03<00:01, 1941.94it/s] 67%|█████████████████████████████████████████████████████████████▎                             | 6564/9741 [00:03<00:01, 1902.51it/s] 70%|███████████████████████████████████████████████████████████████▍                           | 6788/9741 [00:03<00:01, 1998.91it/s] 72%|█████████████████████████████████████████████████████████████████▌                         | 7014/9741 [00:03<00:01, 2072.78it/s] 74%|███████████████████████████████████████████████████████████████████▋                       | 7241/9741 [00:03<00:01, 2130.51it/s] 77%|█████████████████████████████████████████████████████████████████████▋                     | 7456/9741 [00:03<00:01, 2134.07it/s] 79%|███████████████████████████████████████████████████████████████████████▋                   | 7679/9741 [00:03<00:00, 2159.55it/s] 81%|█████████████████████████████████████████████████████████████████████████▊                 | 7904/9741 [00:04<00:00, 2183.97it/s] 83%|███████████████████████████████████████████████████████████████████████████▉               | 8130/9741 [00:04<00:00, 2206.51it/s] 86%|██████████████████████████████████████████████████████████████████████████████             | 8352/9741 [00:04<00:00, 2192.72it/s] 88%|████████████████████████████████████████████████████████████████████████████████           | 8572/9741 [00:04<00:00, 2179.01it/s] 90%|██████████████████████████████████████████████████████████████████████████████████▏        | 8795/9741 [00:04<00:00, 2192.29it/s] 93%|████████████████████████████████████████████████████████████████████████████████████▎      | 9019/9741 [00:04<00:00, 2205.06it/s] 95%|██████████████████████████████████████████████████████████████████████████████████████▎    | 9244/9741 [00:04<00:00, 2216.96it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████▍  | 9468/9741 [00:04<00:00, 2223.36it/s] 99%|██████████████████████████████████████████████████████████████████████████████████████████▌| 9692/9741 [00:04<00:00, 2227.83it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:04<00:00, 1996.93it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.32s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.44s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.56s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:06<00:12,  6.18s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.12s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.19s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.47s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:12<00:06,  6.17s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.50s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.69s/it]
[2023-08-07 22:56:34,451] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.62s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.80s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.99s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.33s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.56s/it]
[2023-08-07 22:56:44,913] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 22:56:44,913] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 22:56:44,914] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7efdfed187c0>
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7efdfed18eb0>
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 22:56:44,915] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 22:56:44,916] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 22:56:44,916] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.33261966705322266 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Answer: 12

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o1-tgsm8k-s42-rFalse
Loading extension module utils...
Time to load utils op: 0.20449161529541016 seconds
Loading extension module utils...
Time to load utils op: 0.20399713516235352 seconds
Loading extension module utils...
Time to load utils op: 0.3042283058166504 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:58<47:56, 58.70s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:16<27:50, 34.80s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:14<35:18, 45.08s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [03:10<37:56, 49.49s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [04:08<39:35, 52.79s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [05:05<39:37, 54.04s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:59<38:47, 54.13s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [06:56<38:29, 54.98s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [07:54<38:06, 55.78s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [08:20<31:08, 46.71s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [09:02<29:29, 45.37s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [09:44<28:00, 44.22s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [10:22<26:12, 42.49s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [10:57<24:08, 40.25s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [11:56<26:39, 45.71s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [12:55<28:10, 49.72s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [13:42<26:54, 48.93s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [14:41<27:37, 51.81s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [15:39<27:50, 53.90s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [16:38<27:36, 55.23s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [17:37<27:13, 56.34s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [18:33<26:20, 56.43s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [19:33<25:50, 57.41s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [20:19<23:27, 54.14s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [21:19<23:11, 55.68s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [21:30<16:58, 42.44s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [22:29<18:08, 47.34s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [23:27<18:33, 50.62s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [24:25<18:26, 52.70s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [25:04<16:10, 48.54s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [25:29<13:10, 41.59s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [26:28<14:04, 46.94s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [27:26<14:11, 50.10s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [28:25<14:03, 52.71s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [29:23<13:37, 54.49s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [30:22<13:01, 55.85s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [30:59<10:51, 50.12s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [31:59<10:37, 53.12s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [32:42<09:09, 49.99s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [33:13<07:21, 44.19s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [34:12<07:18, 48.70s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [35:11<06:54, 51.87s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [36:01<05:58, 51.25s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [36:52<05:07, 51.30s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [37:52<04:29, 53.82s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [38:50<03:40, 55.02s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [39:12<02:15, 45.26s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [40:11<01:38, 49.27s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [41:10<00:52, 52.23s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [41:28<00:00, 41.93s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [41:28<00:00, 49.77s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.9747} | lm_loss 7.6475 | avg. gen lenth: 195.576
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s42-rFalse --num-out-domain 2
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-07 23:40:30,587] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o2-tgsm8k-s42-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 2
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s42-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  2%|█▍                                                                                          | 149/9741 [00:00<00:06, 1487.76it/s]  3%|██▊                                                                                         | 299/9741 [00:00<00:06, 1493.29it/s]  5%|████▏                                                                                       | 449/9741 [00:00<00:06, 1398.42it/s]  6%|█████▋                                                                                      | 600/9741 [00:00<00:06, 1437.55it/s]  8%|███████                                                                                     | 752/9741 [00:00<00:06, 1463.48it/s]  9%|████████▌                                                                                   | 904/9741 [00:00<00:05, 1481.24it/s] 11%|█████████▊                                                                                 | 1057/9741 [00:00<00:05, 1495.00it/s] 12%|███████████▎                                                                               | 1210/9741 [00:00<00:05, 1503.14it/s] 14%|████████████▋                                                                              | 1361/9741 [00:00<00:05, 1476.90it/s] 16%|██████████████                                                                             | 1511/9741 [00:01<00:05, 1483.13it/s] 17%|███████████████▌                                                                           | 1660/9741 [00:01<00:05, 1424.38it/s] 19%|████████████████▊                                                                          | 1803/9741 [00:01<00:05, 1418.78it/s] 20%|██████████████████▏                                                                        | 1953/9741 [00:01<00:05, 1441.83it/s] 22%|███████████████████▋                                                                       | 2103/9741 [00:01<00:05, 1456.39it/s] 23%|█████████████████████                                                                      | 2254/9741 [00:01<00:05, 1470.92it/s] 25%|██████████████████████▍                                                                    | 2406/9741 [00:01<00:04, 1485.41it/s] 26%|███████████████████████▉                                                                   | 2557/9741 [00:01<00:04, 1490.73it/s] 28%|█████████████████████████▎                                                                 | 2707/9741 [00:01<00:04, 1442.75it/s] 29%|██████████████████████████▋                                                                | 2852/9741 [00:01<00:04, 1438.73it/s] 31%|████████████████████████████                                                               | 3004/9741 [00:02<00:04, 1459.61it/s] 32%|█████████████████████████████▍                                                             | 3155/9741 [00:02<00:04, 1471.65it/s] 34%|██████████████████████████████▉                                                            | 3308/9741 [00:02<00:04, 1486.69it/s] 35%|████████████████████████████████▎                                                          | 3458/9741 [00:02<00:04, 1489.93it/s] 37%|█████████████████████████████████▋                                                         | 3608/9741 [00:02<00:04, 1492.27it/s] 39%|███████████████████████████████████                                                        | 3759/9741 [00:02<00:03, 1496.45it/s] 40%|████████████████████████████████████▌                                                      | 3909/9741 [00:02<00:04, 1438.59it/s] 42%|█████████████████████████████████████▉                                                     | 4061/9741 [00:02<00:03, 1460.90it/s] 43%|███████████████████████████████████████▎                                                   | 4211/9741 [00:02<00:03, 1470.29it/s] 45%|████████████████████████████████████████▋                                                  | 4362/9741 [00:02<00:03, 1479.93it/s] 46%|██████████████████████████████████████████▏                                                | 4512/9741 [00:03<00:03, 1485.45it/s] 49%|████████████████████████████████████████████▏                                              | 4727/9741 [00:03<00:02, 1681.54it/s] 50%|█████████████████████████████████████████████▋                                             | 4896/9741 [00:03<00:03, 1468.35it/s] 52%|███████████████████████████████████████████████▍                                           | 5079/9741 [00:03<00:02, 1565.56it/s] 54%|█████████████████████████████████████████████████▌                                         | 5307/9741 [00:03<00:02, 1763.95it/s] 57%|███████████████████████████████████████████████████▋                                       | 5538/9741 [00:03<00:02, 1917.43it/s] 59%|█████████████████████████████████████████████████████▉                                     | 5777/9741 [00:03<00:01, 2051.90it/s] 62%|████████████████████████████████████████████████████████▏                                  | 6016/9741 [00:03<00:01, 2148.05it/s] 64%|██████████████████████████████████████████████████████████▍                                | 6254/9741 [00:03<00:01, 2216.14it/s] 67%|████████████████████████████████████████████████████████████▌                              | 6485/9741 [00:04<00:01, 2240.95it/s] 69%|██████████████████████████████████████████████████████████████▋                            | 6711/9741 [00:04<00:01, 2166.13it/s] 71%|████████████████████████████████████████████████████████████████▉                          | 6952/9741 [00:04<00:01, 2236.38it/s] 74%|███████████████████████████████████████████████████████████████████▏                       | 7193/9741 [00:04<00:01, 2284.99it/s] 76%|█████████████████████████████████████████████████████████████████████▍                     | 7434/9741 [00:04<00:00, 2319.46it/s] 79%|███████████████████████████████████████████████████████████████████████▌                   | 7667/9741 [00:04<00:00, 2282.48it/s] 81%|█████████████████████████████████████████████████████████████████████████▊                 | 7905/9741 [00:04<00:00, 2311.00it/s] 84%|████████████████████████████████████████████████████████████████████████████               | 8137/9741 [00:04<00:00, 2309.43it/s] 86%|██████████████████████████████████████████████████████████████████████████████▏            | 8369/9741 [00:04<00:00, 2246.10it/s] 88%|████████████████████████████████████████████████████████████████████████████████▎          | 8595/9741 [00:04<00:00, 2238.64it/s] 91%|██████████████████████████████████████████████████████████████████████████████████▌        | 8833/9741 [00:05<00:00, 2279.45it/s] 93%|████████████████████████████████████████████████████████████████████████████████████▊      | 9072/9741 [00:05<00:00, 2310.68it/s] 96%|██████████████████████████████████████████████████████████████████████████████████████▉    | 9311/9741 [00:05<00:00, 2333.84it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████▏ | 9547/9741 [00:05<00:00, 2340.55it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:05<00:00, 1790.54it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.23s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.16s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.69s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.64s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.34s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.81s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.56s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.87s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.77s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.90s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.07s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.26s/it]
[2023-08-07 23:41:30,423] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-07 23:41:38,708] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-07 23:41:38,709] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7fa3b605e7c0>
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-07 23:41:38,710] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7fa3b605eeb0>
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-07 23:41:38,711] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-07 23:41:38,711] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.37769532203674316 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Loading extension module utils...
Time to load utils op: 0.30410075187683105 seconds
Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Answer: 40

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o2-tgsm8k-s42-rFalse
Loading extension module utils...
Time to load utils op: 0.20419931411743164 seconds
Loading extension module utils...
Time to load utils op: 0.30271148681640625 seconds
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:48<39:59, 48.97s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:06<24:32, 30.67s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:02<33:08, 42.31s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [02:39<30:35, 39.89s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [03:36<34:44, 46.33s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [04:22<33:50, 46.15s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:18<35:26, 49.45s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [06:13<35:51, 51.22s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [07:08<35:42, 52.25s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [08:04<35:33, 53.33s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [08:59<35:05, 53.99s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [09:56<34:46, 54.90s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [10:51<33:50, 54.89s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [11:48<33:17, 55.49s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [12:13<27:05, 46.45s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [13:10<28:00, 49.43s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [14:07<28:26, 51.70s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [14:58<27:26, 51.46s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [15:27<23:07, 44.74s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [16:24<24:14, 48.49s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [17:20<24:34, 50.86s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [17:41<19:32, 41.87s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [18:38<20:54, 46.46s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [19:35<21:26, 49.47s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [20:32<21:30, 51.63s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [21:19<20:11, 50.47s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [22:16<20:04, 52.36s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [23:14<19:46, 53.94s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [24:09<19:03, 54.45s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [25:07<18:25, 55.29s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [25:32<14:37, 46.17s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [26:17<13:46, 45.92s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [27:14<13:59, 49.41s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [28:10<13:39, 51.21s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [28:53<12:13, 48.91s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [29:27<10:20, 44.34s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [30:23<10:22, 47.91s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [31:19<10:03, 50.31s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [31:45<07:52, 42.93s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [32:41<07:49, 46.93s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [33:37<07:25, 49.52s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [34:31<06:47, 50.91s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [35:27<06:07, 52.54s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [35:47<04:16, 42.72s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [36:04<02:54, 34.89s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [36:43<02:25, 36.31s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [37:41<02:08, 42.68s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [38:37<01:33, 46.87s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [39:15<00:43, 43.97s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:10<00:00, 47.32s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:10<00:00, 48.21s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.1441} | lm_loss 7.6503 | avg. gen lenth: 194.796
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s42-rFalse --num-out-domain 3
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-08 00:22:04,356] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o3-tgsm8k-s42-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 3
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s42-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  1%|█▏                                                                                          | 125/9741 [00:00<00:07, 1244.20it/s]  3%|██▎                                                                                         | 250/9741 [00:00<00:07, 1231.45it/s]  4%|███▌                                                                                        | 376/9741 [00:00<00:07, 1240.16it/s]  5%|████▋                                                                                       | 501/9741 [00:00<00:07, 1241.75it/s]  6%|█████▉                                                                                      | 626/9741 [00:00<00:07, 1240.90it/s]  8%|███████                                                                                     | 752/9741 [00:00<00:07, 1244.13it/s]  9%|████████▎                                                                                   | 879/9741 [00:00<00:07, 1251.07it/s] 10%|█████████▍                                                                                 | 1005/9741 [00:00<00:06, 1251.30it/s] 12%|██████████▌                                                                                | 1131/9741 [00:00<00:07, 1222.56it/s] 13%|███████████▋                                                                               | 1255/9741 [00:01<00:06, 1226.73it/s] 14%|████████████▉                                                                              | 1380/9741 [00:01<00:06, 1233.01it/s] 15%|██████████████                                                                             | 1505/9741 [00:01<00:06, 1237.78it/s] 17%|███████████████▏                                                                           | 1630/9741 [00:01<00:06, 1240.24it/s] 18%|████████████████▍                                                                          | 1756/9741 [00:01<00:06, 1245.88it/s] 19%|█████████████████▌                                                                         | 1881/9741 [00:01<00:06, 1219.35it/s] 21%|██████████████████▋                                                                        | 2006/9741 [00:01<00:06, 1227.91it/s] 22%|███████████████████▉                                                                       | 2129/9741 [00:01<00:06, 1225.01it/s] 23%|█████████████████████                                                                      | 2254/9741 [00:01<00:06, 1231.64it/s] 24%|██████████████████████▏                                                                    | 2378/9741 [00:01<00:05, 1233.21it/s] 26%|███████████████████████▍                                                                   | 2503/9741 [00:02<00:05, 1236.24it/s] 27%|████████████████████████▌                                                                  | 2629/9741 [00:02<00:05, 1242.20it/s] 28%|█████████████████████████▋                                                                 | 2754/9741 [00:02<00:05, 1238.30it/s] 30%|██████████████████████████▉                                                                | 2880/9741 [00:02<00:05, 1241.88it/s] 31%|████████████████████████████                                                               | 3005/9741 [00:02<00:05, 1242.33it/s] 32%|█████████████████████████████▏                                                             | 3130/9741 [00:02<00:05, 1240.25it/s] 33%|██████████████████████████████▍                                                            | 3255/9741 [00:02<00:05, 1240.26it/s] 35%|███████████████████████████████▌                                                           | 3380/9741 [00:02<00:05, 1237.71it/s] 36%|████████████████████████████████▋                                                          | 3504/9741 [00:02<00:05, 1234.82it/s] 37%|█████████████████████████████████▉                                                         | 3628/9741 [00:02<00:04, 1235.74it/s] 39%|███████████████████████████████████                                                        | 3753/9741 [00:03<00:04, 1239.90it/s] 40%|████████████████████████████████████▏                                                      | 3877/9741 [00:03<00:04, 1237.42it/s] 41%|█████████████████████████████████████▍                                                     | 4001/9741 [00:03<00:04, 1222.94it/s] 43%|███████████████████████████████████████                                                    | 4179/9741 [00:03<00:04, 1387.18it/s] 45%|████████████████████████████████████████▊                                                  | 4367/9741 [00:03<00:03, 1533.52it/s] 47%|██████████████████████████████████████████▍                                                | 4539/9741 [00:03<00:03, 1588.59it/s] 49%|████████████████████████████████████████████▏                                              | 4729/9741 [00:03<00:02, 1679.30it/s] 50%|█████████████████████████████████████████████▊                                             | 4898/9741 [00:03<00:03, 1317.31it/s] 52%|███████████████████████████████████████████████▌                                           | 5087/9741 [00:03<00:03, 1459.48it/s] 54%|█████████████████████████████████████████████████▏                                         | 5262/9741 [00:04<00:02, 1534.43it/s] 56%|██████████████████████████████████████████████████▉                                        | 5452/9741 [00:04<00:02, 1632.09it/s] 58%|████████████████████████████████████████████████████▊                                      | 5648/9741 [00:04<00:02, 1723.39it/s] 60%|██████████████████████████████████████████████████████▌                                    | 5845/9741 [00:04<00:02, 1791.71it/s] 62%|████████████████████████████████████████████████████████▍                                  | 6043/9741 [00:04<00:02, 1845.21it/s] 64%|██████████████████████████████████████████████████████████▏                                | 6232/9741 [00:04<00:01, 1855.77it/s] 66%|████████████████████████████████████████████████████████████                               | 6429/9741 [00:04<00:01, 1888.30it/s] 68%|█████████████████████████████████████████████████████████████▊                             | 6620/9741 [00:04<00:01, 1804.33it/s] 70%|███████████████████████████████████████████████████████████████▋                           | 6817/9741 [00:04<00:01, 1851.26it/s] 72%|█████████████████████████████████████████████████████████████████▍                         | 7011/9741 [00:04<00:01, 1875.77it/s] 74%|███████████████████████████████████████████████████████████████████▎                       | 7211/9741 [00:05<00:01, 1909.40it/s] 76%|█████████████████████████████████████████████████████████████████████▏                     | 7410/9741 [00:05<00:01, 1932.99it/s] 78%|███████████████████████████████████████████████████████████████████████                    | 7604/9741 [00:05<00:01, 1892.35it/s] 80%|████████████████████████████████████████████████████████████████████████▉                  | 7804/9741 [00:05<00:01, 1921.40it/s] 82%|██████████████████████████████████████████████████████████████████████████▋                | 8000/9741 [00:05<00:00, 1927.27it/s] 84%|████████████████████████████████████████████████████████████████████████████▌              | 8194/9741 [00:05<00:00, 1860.49it/s] 86%|██████████████████████████████████████████████████████████████████████████████▍            | 8391/9741 [00:05<00:00, 1890.96it/s] 88%|████████████████████████████████████████████████████████████████████████████████▏          | 8590/9741 [00:05<00:00, 1918.39it/s] 90%|██████████████████████████████████████████████████████████████████████████████████         | 8790/9741 [00:05<00:00, 1940.47it/s] 92%|███████████████████████████████████████████████████████████████████████████████████▉       | 8990/9741 [00:05<00:00, 1955.78it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████▊     | 9187/9741 [00:06<00:00, 1958.53it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████▋   | 9385/9741 [00:06<00:00, 1962.24it/s] 98%|█████████████████████████████████████████████████████████████████████████████████████████▌ | 9582/9741 [00:06<00:00, 1872.54it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:06<00:00, 1528.30it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.01s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.38s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.21s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.16s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.25s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:10<00:05,  5.14s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.57s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.57s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.71s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.56s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.72s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.79s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.92s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  4.85s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.04s/it]
[2023-08-08 00:23:04,182] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
[2023-08-08 00:23:12,757] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-08 00:23:12,758] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-08 00:23:12,758] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-08 00:23:12,758] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-08 00:23:12,758] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-08 00:23:12,758] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f873aa197c0>
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f873aa19eb0>
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-08 00:23:12,759] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-08 00:23:12,760] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-08 00:23:12,760] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.36333537101745605 seconds
Loading extension module utils...
Time to load utils op: 0.204484224319458 seconds
Loading extension module utils...
Time to load utils op: 0.30464744567871094 seconds
Loading extension module utils...
Time to load utils op: 0.4046950340270996 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Answer: 40

Input: Jack has a stack of books that is 12 inches thick. He knows from experience that 80 pages is one inch thick. If he has 6 books, how many pages is each one on average?
Answer: 160

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o3-tgsm8k-s42-rFalse
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:37<30:22, 37.19s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:33<38:57, 48.69s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:18<36:31, 46.63s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [03:13<38:20, 50.01s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [04:08<38:49, 51.77s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [05:03<38:45, 52.86s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:34<32:47, 45.75s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [05:56<26:49, 38.33s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [06:52<29:53, 43.73s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [07:47<31:34, 47.36s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [08:32<30:17, 46.60s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [09:28<31:18, 49.43s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [10:05<28:07, 45.62s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [11:00<29:00, 48.33s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [11:53<29:07, 49.92s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [12:48<29:07, 51.39s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [13:13<23:55, 43.50s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [14:08<24:59, 46.86s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [14:41<22:01, 42.62s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [15:35<23:03, 46.12s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [16:30<23:40, 48.97s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [17:22<23:13, 49.76s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [18:17<23:06, 51.37s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [19:12<22:46, 52.56s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [19:34<17:57, 43.10s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [20:29<18:44, 46.85s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [20:51<15:03, 39.29s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [21:11<12:19, 33.62s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [22:06<13:57, 39.88s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [22:19<10:36, 31.81s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [23:13<12:12, 38.56s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [24:09<13:06, 43.68s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [25:04<13:21, 47.14s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [25:57<13:05, 49.08s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [26:52<12:41, 50.76s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [27:47<12:08, 52.07s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [28:43<11:30, 53.08s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [29:32<10:23, 52.00s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [30:27<09:41, 52.82s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [31:22<08:54, 53.44s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [31:50<06:51, 45.78s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [32:25<05:40, 42.60s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [33:20<05:24, 46.38s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [34:16<04:54, 49.13s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [34:43<03:33, 42.73s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [35:38<03:05, 46.43s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [36:34<02:27, 49.18s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [37:30<01:42, 51.13s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [38:08<00:47, 47.21s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [39:03<00:00, 49.57s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [39:03<00:00, 46.87s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.2951} | lm_loss 7.6872 | avg. gen lenth: 196.484
torchrun --nproc_per_node 4 --nnodes 1 --node_rank 0 --master_addr localhost --master_port 29501 /home/ylu130/workspace/in-context-generalization/inference.py --model-name llama2-7b --model-type llama --model-path /scratch/ylu130/model/llama-2-7b --n-gpu 4 --is-opensource --data-name commonsenseqa --num-eval 1000 --num-workers 0 --num-in-domain 0 --out-domain-data-name gsm8k --save /home/ylu130/workspace/in-context-generalization/results --do-sample --top-k 50 --top-p 1 --temperature 1 --deepspeed --deepspeed_config /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json --batch-size 5 --seed 42 --data-dir /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s42-rFalse --num-out-domain 4
WARNING:torch.distributed.run:
*****************************************
Setting OMP_NUM_THREADS environment variable for each process to be 1 in default, to avoid your system being overloaded, please further tune the variable for optimal performance in your application as needed. 
*****************************************
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data] Downloading package punkt to /home/ylu130/nltk_data...
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
[nltk_data]   Package punkt is already up-to-date!
using world size: 4
[2023-08-08 01:04:43,292] [INFO] [comm.py:657:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
arguments:
  model_name ................... llama2-7b
  model_type ................... llama
  model_path ................... /scratch/ylu130/model/llama-2-7b
  n_gpu ........................ 4
  n_nodes ...................... 1
  is_opensource ................ True
  model_parallel ............... False
  model_parallel_size .......... None
  data_name .................... commonsenseqa
  data_dir ..................... /scratch/ylu130/processed_data/commonsenseqa/out-domain/o4-tgsm8k-s42-rFalse
  processed_data_dir ........... None
  num_eval ..................... 1000
  num_in_domain ................ 0
  num_out_domain ............... 4
  out_domain_data_name ......... gsm8k
  out_domain_data_dir .......... None
  num_workers .................. 0
  max_prompt_length ............ 2048
  max_length ................... 512
  save ......................... /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s42-rFalse
  rationales ................... False
  top_k ........................ 50
  top_p ........................ 1.0
  do_sample .................... True
  temperature .................. 1.0
  no_repeat_ngram_size ......... 6
  repetition_penalty ........... None
  gradient_accumulation_steps .. 1
  batch_size ................... 5
  clip_grad .................... 1.0
  seed ......................... 42
  deepspeed .................... True
  deepspeed_config ............. /home/ylu130/workspace/in-context-generalization/configs/deepspeed/ds_config.json
  deepscale .................... False
  deepscale_config ............. None
  deepspeed_mpi ................ False
  local_rank ................... 0
  rank ......................... 0
  world_size ................... 4
Loading Data
  0%|                                                                                                        | 0/9741 [00:00<?, ?it/s]  1%|▉                                                                                             | 96/9741 [00:00<00:10, 951.61it/s]  2%|█▊                                                                                           | 192/9741 [00:00<00:09, 955.58it/s]  3%|██▋                                                                                          | 288/9741 [00:00<00:09, 953.83it/s]  4%|███▋                                                                                         | 384/9741 [00:00<00:09, 941.27it/s]  5%|████▌                                                                                        | 479/9741 [00:00<00:09, 937.54it/s]  6%|█████▍                                                                                       | 576/9741 [00:00<00:09, 945.70it/s]  7%|██████▍                                                                                      | 672/9741 [00:00<00:09, 947.46it/s]  8%|███████▎                                                                                     | 768/9741 [00:00<00:09, 937.44it/s]  9%|████████▏                                                                                    | 863/9741 [00:00<00:09, 940.55it/s] 10%|█████████▏                                                                                   | 958/9741 [00:01<00:09, 943.17it/s] 11%|█████████▉                                                                                  | 1055/9741 [00:01<00:09, 949.38it/s] 12%|██████████▊                                                                                 | 1150/9741 [00:01<00:09, 938.45it/s] 13%|███████████▊                                                                                | 1245/9741 [00:01<00:09, 941.39it/s] 14%|████████████▋                                                                               | 1340/9741 [00:01<00:08, 942.26it/s] 15%|█████████████▌                                                                              | 1436/9741 [00:01<00:08, 945.42it/s] 16%|██████████████▍                                                                             | 1532/9741 [00:01<00:08, 948.23it/s] 17%|███████████████▎                                                                            | 1627/9741 [00:01<00:08, 948.57it/s] 18%|████████████████▎                                                                           | 1722/9741 [00:01<00:08, 942.49it/s] 19%|█████████████████▏                                                                          | 1817/9741 [00:01<00:10, 787.23it/s] 20%|█████████████████▉                                                                          | 1901/9741 [00:02<00:10, 717.04it/s] 20%|██████████████████▋                                                                         | 1977/9741 [00:02<00:11, 698.34it/s] 21%|███████████████████▎                                                                        | 2050/9741 [00:02<00:11, 675.17it/s] 22%|████████████████████                                                                        | 2120/9741 [00:02<00:11, 635.39it/s] 23%|████████████████████▉                                                                       | 2211/9741 [00:02<00:10, 704.80it/s] 24%|█████████████████████▊                                                                      | 2305/9741 [00:02<00:09, 765.87it/s] 25%|██████████████████████▋                                                                     | 2401/9741 [00:02<00:08, 817.53it/s] 26%|███████████████████████▌                                                                    | 2496/9741 [00:02<00:08, 854.82it/s] 27%|████████████████████████▍                                                                   | 2592/9741 [00:03<00:08, 884.35it/s] 28%|█████████████████████████▍                                                                  | 2688/9741 [00:03<00:07, 905.88it/s] 29%|██████████████████████████▎                                                                 | 2784/9741 [00:03<00:07, 919.61it/s] 30%|███████████████████████████▏                                                                | 2879/9741 [00:03<00:07, 926.00it/s] 31%|████████████████████████████                                                                | 2975/9741 [00:03<00:07, 934.29it/s] 32%|█████████████████████████████                                                               | 3071/9741 [00:03<00:07, 940.69it/s] 33%|█████████████████████████████▉                                                              | 3167/9741 [00:03<00:06, 946.11it/s] 34%|██████████████████████████████▊                                                             | 3265/9741 [00:03<00:06, 954.02it/s] 35%|███████████████████████████████▊                                                            | 3362/9741 [00:03<00:06, 957.17it/s] 35%|████████████████████████████████▋                                                           | 3458/9741 [00:03<00:06, 957.52it/s] 36%|█████████████████████████████████▌                                                          | 3555/9741 [00:04<00:06, 958.89it/s] 37%|██████████████████████████████████▍                                                         | 3651/9741 [00:04<00:06, 957.80it/s] 38%|███████████████████████████████████▍                                                        | 3747/9741 [00:04<00:06, 954.44it/s] 39%|████████████████████████████████████▎                                                       | 3843/9741 [00:04<00:06, 953.74it/s] 40%|█████████████████████████████████████▏                                                      | 3939/9741 [00:04<00:06, 955.47it/s] 41%|██████████████████████████████████████                                                      | 4036/9741 [00:04<00:05, 958.80it/s] 42%|███████████████████████████████████████                                                     | 4132/9741 [00:04<00:05, 957.65it/s] 43%|███████████████████████████████████████▉                                                    | 4229/9741 [00:04<00:05, 959.18it/s] 44%|████████████████████████████████████████▊                                                   | 4326/9741 [00:04<00:05, 959.92it/s] 45%|█████████████████████████████████████████▊                                                  | 4423/9741 [00:04<00:05, 961.09it/s] 46%|██████████████████████████████████████████▋                                                 | 4520/9741 [00:05<00:05, 884.88it/s] 47%|███████████████████████████████████████████▌                                                | 4617/9741 [00:05<00:05, 906.93it/s] 48%|████████████████████████████████████████████▌                                               | 4721/9741 [00:05<00:05, 943.64it/s] 49%|█████████████████████████████████████████████▍                                              | 4817/9741 [00:05<00:06, 759.81it/s] 51%|██████████████████████████████████████████████▊                                             | 4963/9741 [00:05<00:05, 933.39it/s] 52%|███████████████████████████████████████████████▋                                           | 5110/9741 [00:05<00:04, 1074.15it/s] 54%|█████████████████████████████████████████████████                                          | 5253/9741 [00:05<00:03, 1170.94it/s] 55%|██████████████████████████████████████████████████▎                                        | 5391/9741 [00:05<00:03, 1229.16it/s] 57%|███████████████████████████████████████████████████▋                                       | 5531/9741 [00:05<00:03, 1277.84it/s] 58%|█████████████████████████████████████████████████████                                      | 5684/9741 [00:06<00:03, 1349.16it/s] 60%|██████████████████████████████████████████████████████▌                                    | 5835/9741 [00:06<00:02, 1394.13it/s] 61%|███████████████████████████████████████████████████████▉                                   | 5987/9741 [00:06<00:02, 1430.55it/s] 63%|█████████████████████████████████████████████████████████▎                                 | 6139/9741 [00:06<00:02, 1456.74it/s] 65%|██████████████████████████████████████████████████████████▊                                | 6292/9741 [00:06<00:02, 1476.30it/s] 66%|████████████████████████████████████████████████████████████▏                              | 6441/9741 [00:06<00:02, 1443.22it/s] 68%|█████████████████████████████████████████████████████████████▌                             | 6592/9741 [00:06<00:02, 1462.24it/s] 69%|███████████████████████████████████████████████████████████████                            | 6746/9741 [00:06<00:02, 1482.94it/s] 71%|████████████████████████████████████████████████████████████████▍                          | 6899/9741 [00:06<00:01, 1495.84it/s] 72%|█████████████████████████████████████████████████████████████████▉                         | 7052/9741 [00:06<00:01, 1504.09it/s] 74%|███████████████████████████████████████████████████████████████████▎                       | 7206/9741 [00:07<00:01, 1512.03it/s] 76%|████████████████████████████████████████████████████████████████████▋                      | 7359/9741 [00:07<00:01, 1516.52it/s] 77%|██████████████████████████████████████████████████████████████████████▏                    | 7511/9741 [00:07<00:01, 1399.98it/s] 79%|███████████████████████████████████████████████████████████████████████▌                   | 7662/9741 [00:07<00:01, 1430.47it/s] 80%|█████████████████████████████████████████████████████████████████████████                  | 7815/9741 [00:07<00:01, 1457.04it/s] 82%|██████████████████████████████████████████████████████████████████████████▍                | 7967/9741 [00:07<00:01, 1473.54it/s] 83%|███████████████████████████████████████████████████████████████████████████▊               | 8120/9741 [00:07<00:01, 1487.80it/s] 85%|█████████████████████████████████████████████████████████████████████████████▎             | 8273/9741 [00:07<00:00, 1497.34it/s] 86%|██████████████████████████████████████████████████████████████████████████████▋            | 8424/9741 [00:07<00:00, 1472.10it/s] 88%|████████████████████████████████████████████████████████████████████████████████           | 8572/9741 [00:07<00:00, 1473.00it/s] 90%|█████████████████████████████████████████████████████████████████████████████████▍         | 8720/9741 [00:08<00:00, 1464.39it/s] 91%|██████████████████████████████████████████████████████████████████████████████████▊        | 8871/9741 [00:08<00:00, 1476.64it/s] 93%|████████████████████████████████████████████████████████████████████████████████████▎      | 9024/9741 [00:08<00:00, 1490.26it/s] 94%|█████████████████████████████████████████████████████████████████████████████████████▋     | 9174/9741 [00:08<00:00, 1484.16it/s] 96%|███████████████████████████████████████████████████████████████████████████████████████    | 9325/9741 [00:08<00:00, 1488.77it/s] 97%|████████████████████████████████████████████████████████████████████████████████████████▌  | 9474/9741 [00:08<00:00, 1470.06it/s] 99%|█████████████████████████████████████████████████████████████████████████████████████████▉ | 9625/9741 [00:08<00:00, 1481.47it/s]100%|███████████████████████████████████████████████████████████████████████████████████████████| 9741/9741 [00:08<00:00, 1110.26it/s]
Load End
Num instances: 1000
Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:   0%|                                                                                | 0/3 [00:00<?, ?it/s]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.69s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.69s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:10,  5.46s/it]Loading checkpoint shards:  33%|████████████████████████                                                | 1/3 [00:05<00:11,  5.68s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.54s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:12<00:06,  6.35s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:12<00:06,  6.08s/it]Loading checkpoint shards:  67%|████████████████████████████████████████████████                        | 2/3 [00:11<00:05,  5.74s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.74s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:14<00:00,  4.95s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.45s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:16<00:00,  5.63s/it]
[2023-08-08 01:05:47,274] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed info: version=0.8.0, git-hash=unknown, git-branch=unknown
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.60s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:17<00:00,  5.69s/it]
Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.05s/it]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████| 3/3 [00:15<00:00,  5.23s/it]
[2023-08-08 01:06:02,232] [INFO] [logging.py:68:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
[2023-08-08 01:06:02,233] [INFO] [config.py:1008:print] DeepSpeedEngine configuration:
[2023-08-08 01:06:02,234] [INFO] [config.py:1012:print]   activation_checkpointing_config  {
    "partition_activations": false, 
    "contiguous_memory_optimization": false, 
    "cpu_checkpointing": false, 
    "number_checkpoints": null, 
    "synchronize_checkpoint_boundary": false, 
    "profile": false
}
[2023-08-08 01:06:02,234] [INFO] [config.py:1012:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True}
[2023-08-08 01:06:02,234] [INFO] [config.py:1012:print]   amp_enabled .................. False
[2023-08-08 01:06:02,234] [INFO] [config.py:1012:print]   amp_params ................... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   autotuning_config ............ {
    "enabled": false, 
    "start_step": null, 
    "end_step": null, 
    "metric_path": null, 
    "arg_mappings": null, 
    "metric": "throughput", 
    "model_info": null, 
    "results_dir": "autotuning_results", 
    "exps_dir": "autotuning_exps", 
    "overwrite": true, 
    "fast": true, 
    "start_profile_step": 3, 
    "end_profile_step": 5, 
    "tuner_type": "gridsearch", 
    "tuner_early_stopping": 5, 
    "tuner_num_trials": 50, 
    "model_info_path": null, 
    "mp_size": 1, 
    "max_train_batch_size": null, 
    "min_train_batch_size": 1, 
    "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
    "min_train_micro_batch_size_per_gpu": 1, 
    "num_tuning_micro_batch_sizes": 3
}
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   bfloat16_enabled ............. False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   checkpoint_parallel_write_pipeline  False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   checkpoint_tag_validation_enabled  True
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   checkpoint_tag_validation_fail  False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0x7f599bf0f7c0>
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   communication_data_type ...... None
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   curriculum_enabled_legacy .... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   curriculum_params_legacy ..... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   data_efficiency_enabled ...... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   dataloader_drop_last ......... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   disable_allgather ............ False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   dump_state ................... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   dynamic_loss_scale_args ...... {'init_scale': 2048, 'scale_window': 2000, 'delayed_shift': 4, 'min_scale': 1}
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_enabled ........... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_gas_boundary_resolution  1
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_layer_name ........ bert.encoder.layer
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_layer_num ......... 0
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_max_iter .......... 100
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_stability ......... 1e-06
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_tol ............... 0.01
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   eigenvalue_verbose ........... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   elasticity_enabled ........... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   flops_profiler_config ........ {
    "enabled": false, 
    "profile_step": 1, 
    "module_depth": -1, 
    "top_modules": 1, 
    "detailed": true, 
    "output_file": null
}
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   fp16_auto_cast ............... False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   fp16_enabled ................. True
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   fp16_master_weights_and_gradients  False
[2023-08-08 01:06:02,235] [INFO] [config.py:1012:print]   global_rank .................. 0
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   grad_accum_dtype ............. None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   gradient_accumulation_steps .. 1
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   gradient_clipping ............ 1.0
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   gradient_predivide_factor .... 1.0
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   initial_dynamic_scale ........ 2048
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   load_universal_checkpoint .... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   loss_scale ................... 0
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   memory_breakdown ............. False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   monitor_config ............... <deepspeed.monitor.config.DeepSpeedMonitorConfig object at 0x7f599bf0feb0>
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   nebula_config ................ {
    "enabled": false, 
    "persistent_storage_path": null, 
    "persistent_time_interval": 100, 
    "num_of_version_in_retention": 2, 
    "enable_nebula_load": true, 
    "load_path": null
}
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   optimizer_legacy_fusion ...... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   optimizer_name ............... None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   optimizer_params ............. None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0}
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   pld_enabled .................. False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   pld_params ................... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   prescale_gradients ........... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   scheduler_name ............... None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   scheduler_params ............. None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   sparse_attention ............. None
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   sparse_gradients_enabled ..... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   steps_per_print .............. 1
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   train_batch_size ............. 20
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   train_micro_batch_size_per_gpu  5
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   use_node_local_storage ....... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   wall_clock_breakdown ......... False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   world_size ................... 4
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   zero_allow_untested_optimizer  True
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   zero_config .................. stage=0 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500,000,000 allgather_partitions=True allgather_bucket_size=500,000,000 overlap_comm=False load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1,000,000,000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50,000,000 param_persistence_threshold=100,000 model_persistence_threshold=sys.maxsize max_live_parameters=1,000,000,000 max_reuse_distance=1,000,000,000 gather_16bit_weights_on_model_save=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   zero_enabled ................. False
[2023-08-08 01:06:02,236] [INFO] [config.py:1012:print]   zero_optimization_stage ...... 0
[2023-08-08 01:06:02,236] [INFO] [config.py:997:print_user_config]   json = {
    "train_micro_batch_size_per_gpu": 5, 
    "gradient_accumulation_steps": 1, 
    "zero_optimization": {
        "stage": 0
    }, 
    "zero_allow_untested_optimizer": true, 
    "fp16": {
        "enabled": true, 
        "loss_scale": 0, 
        "initial_scale_power": 11, 
        "loss_scale_window": 2.000000e+03, 
        "hysteresis": 4
    }, 
    "wall_clock_breakdown": false, 
    "gradient_clipping": 1.0, 
    "steps_per_print": 1
}
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Using /home/ylu130/.cache/torch_extensions/py39_cu113 as PyTorch extensions root...
Emitting ninja build file /home/ylu130/.cache/torch_extensions/py39_cu113/utils/build.ninja...
Building extension module utils...
Allowing ninja to set a default number of workers... (overridable by setting the environment variable MAX_JOBS=N)
ninja: no work to do.
Loading extension module utils...
Time to load utils op: 0.5055556297302246 seconds
Loading extension module utils...
Time to load utils op: 0.5033140182495117 seconds
Loading extension module utils...
Time to load utils op: 0.5048108100891113 seconds
Loading extension module utils...
Time to load utils op: 0.5044279098510742 seconds
Model mem
 |===========================================================================|
|                  PyTorch CUDA memory summary, device ID 0                 |
|---------------------------------------------------------------------------|
|            CUDA OOMs: 0            |        cudaMalloc retries: 0         |
|===========================================================================|
|        Metric         | Cur Usage  | Peak Usage | Tot Alloc  | Tot Freed  |
|---------------------------------------------------------------------------|
| Allocated memory      |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| Active memory         |   12916 MB |   12916 MB |   12916 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      64 MB |      64 MB |      64 MB |       0 B  |
|---------------------------------------------------------------------------|
| GPU reserved memory   |   12918 MB |   12918 MB |   12918 MB |       0 B  |
|       from large pool |   12852 MB |   12852 MB |   12852 MB |       0 B  |
|       from small pool |      66 MB |      66 MB |      66 MB |       0 B  |
|---------------------------------------------------------------------------|
| Non-releasable memory |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|       from large pool |       0 KB |       0 KB |       0 KB |       0 KB |
|       from small pool |    1512 KB |    2047 KB |   34815 KB |   33303 KB |
|---------------------------------------------------------------------------|
| Allocations           |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| Active allocs         |     387    |     387    |     387    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |     161    |     161    |     161    |       0    |
|---------------------------------------------------------------------------|
| GPU reserved segments |     259    |     259    |     259    |       0    |
|       from large pool |     226    |     226    |     226    |       0    |
|       from small pool |      33    |      33    |      33    |       0    |
|---------------------------------------------------------------------------|
| Non-releasable allocs |       2    |       2    |      33    |      31    |
|       from large pool |       0    |       0    |       0    |       0    |
|       from small pool |       2    |       2    |      33    |      31    |
|---------------------------------------------------------------------------|
| Oversize allocations  |       0    |       0    |       0    |       0    |
|---------------------------------------------------------------------------|
| Oversize GPU segments |       0    |       0    |       0    |       0    |
|===========================================================================|

Evaluating commonsenseqa :   0%|                                                                               | 0/50 [00:00<?, ?it/s]############### Example ###############
Below is an instruction that describes a task. Write a response that appropriately completes the request.

### Instruction:Answer the following multiple choice question.

### Demonstration:
Input: For every 12 cans you recycle, you receive $0.50, and for every 5 kilograms of newspapers, you receive $1.50. If your family collected 144 cans and 20 kilograms of newspapers, how much money would you receive?
Answer: 12

Input: Betty picked 16 strawberries. Matthew picked 20 more strawberries than Betty and twice as many as Natalie. They used their strawberries to make jam. One jar of jam used 7 strawberries and they sold each jar at $4. How much money were they able to make from the strawberries they picked?
Answer: 40

Input: Jack has a stack of books that is 12 inches thick. He knows from experience that 80 pages is one inch thick. If he has 6 books, how many pages is each one on average?
Answer: 160

Input: James dumps his whole collection of 500 Legos on the floor and starts building a castle out of them.  He uses half the pieces before finishing and is told to put the rest away.  He puts all of the leftover pieces back in the box they came from, except for 5 missing pieces that he can't find.  How many Legos are in the box at the end?
Answer: 245

### Input:The sanctions against the school were a punishing blow, and they seemed to what the efforts the school had made to change? Choices:  A: ignore B: enforce C: authoritarian D: yell at E: avoid

### Response:
############### End ###############
Experiment Save Path: /home/ylu130/workspace/in-context-generalization/results/llama2-7b/commonsenseqa/out-domain/o4-tgsm8k-s42-rFalse
Evaluating commonsenseqa :   2%|█▍                                                                     | 1/50 [00:36<30:11, 36.96s/it]Evaluating commonsenseqa :   4%|██▊                                                                    | 2/50 [01:31<37:51, 47.31s/it]Evaluating commonsenseqa :   6%|████▎                                                                  | 3/50 [02:04<31:56, 40.78s/it]Evaluating commonsenseqa :   8%|█████▋                                                                 | 4/50 [02:58<35:23, 46.15s/it]Evaluating commonsenseqa :  10%|███████                                                                | 5/50 [03:54<37:02, 49.38s/it]Evaluating commonsenseqa :  12%|████████▌                                                              | 6/50 [04:48<37:28, 51.10s/it]Evaluating commonsenseqa :  14%|█████████▉                                                             | 7/50 [05:16<31:11, 43.53s/it]Evaluating commonsenseqa :  16%|███████████▎                                                           | 8/50 [06:09<32:31, 46.45s/it]Evaluating commonsenseqa :  18%|████████████▊                                                          | 9/50 [07:02<33:16, 48.69s/it]Evaluating commonsenseqa :  20%|██████████████                                                        | 10/50 [07:53<32:48, 49.22s/it]Evaluating commonsenseqa :  22%|███████████████▍                                                      | 11/50 [08:48<33:11, 51.06s/it]Evaluating commonsenseqa :  24%|████████████████▊                                                     | 12/50 [09:41<32:38, 51.54s/it]Evaluating commonsenseqa :  26%|██████████████████▏                                                   | 13/50 [10:33<31:57, 51.81s/it]Evaluating commonsenseqa :  28%|███████████████████▌                                                  | 14/50 [11:28<31:36, 52.67s/it]Evaluating commonsenseqa :  30%|█████████████████████                                                 | 15/50 [12:21<30:48, 52.82s/it]Evaluating commonsenseqa :  32%|██████████████████████▍                                               | 16/50 [13:15<30:05, 53.12s/it]Evaluating commonsenseqa :  34%|███████████████████████▊                                              | 17/50 [14:10<29:31, 53.68s/it]Evaluating commonsenseqa :  36%|█████████████████████████▏                                            | 18/50 [15:03<28:31, 53.50s/it]Evaluating commonsenseqa :  38%|██████████████████████████▌                                           | 19/50 [15:35<24:21, 47.16s/it]Evaluating commonsenseqa :  40%|████████████████████████████                                          | 20/50 [16:23<23:45, 47.51s/it]Evaluating commonsenseqa :  42%|█████████████████████████████▍                                        | 21/50 [17:17<23:53, 49.44s/it]Evaluating commonsenseqa :  44%|██████████████████████████████▊                                       | 22/50 [18:10<23:32, 50.43s/it]Evaluating commonsenseqa :  46%|████████████████████████████████▏                                     | 23/50 [18:55<21:55, 48.72s/it]Evaluating commonsenseqa :  48%|█████████████████████████████████▌                                    | 24/50 [19:49<21:47, 50.30s/it]Evaluating commonsenseqa :  50%|███████████████████████████████████                                   | 25/50 [20:15<17:59, 43.16s/it]Evaluating commonsenseqa :  52%|████████████████████████████████████▍                                 | 26/50 [20:52<16:32, 41.34s/it]Evaluating commonsenseqa :  54%|█████████████████████████████████████▊                                | 27/50 [21:44<17:04, 44.56s/it]Evaluating commonsenseqa :  56%|███████████████████████████████████████▏                              | 28/50 [22:37<17:15, 47.06s/it]Evaluating commonsenseqa :  58%|████████████████████████████████████████▌                             | 29/50 [23:31<17:08, 48.97s/it]Evaluating commonsenseqa :  60%|██████████████████████████████████████████                            | 30/50 [24:23<16:38, 49.90s/it]Evaluating commonsenseqa :  62%|███████████████████████████████████████████▍                          | 31/50 [25:16<16:06, 50.89s/it]Evaluating commonsenseqa :  64%|████████████████████████████████████████████▊                         | 32/50 [26:10<15:33, 51.87s/it]Evaluating commonsenseqa :  66%|██████████████████████████████████████████████▏                       | 33/50 [26:35<12:24, 43.80s/it]Evaluating commonsenseqa :  68%|███████████████████████████████████████████████▌                      | 34/50 [27:28<12:24, 46.56s/it]Evaluating commonsenseqa :  70%|█████████████████████████████████████████████████                     | 35/50 [28:14<11:36, 46.40s/it]Evaluating commonsenseqa :  72%|██████████████████████████████████████████████████▍                   | 36/50 [29:08<11:21, 48.69s/it]Evaluating commonsenseqa :  74%|███████████████████████████████████████████████████▊                  | 37/50 [30:01<10:48, 49.85s/it]Evaluating commonsenseqa :  76%|█████████████████████████████████████████████████████▏                | 38/50 [30:54<10:09, 50.79s/it]Evaluating commonsenseqa :  78%|██████████████████████████████████████████████████████▌               | 39/50 [31:51<09:40, 52.80s/it]Evaluating commonsenseqa :  80%|████████████████████████████████████████████████████████              | 40/50 [32:48<08:58, 53.86s/it]Evaluating commonsenseqa :  82%|█████████████████████████████████████████████████████████▍            | 41/50 [33:29<07:31, 50.18s/it]Evaluating commonsenseqa :  84%|██████████████████████████████████████████████████████████▊           | 42/50 [34:26<06:57, 52.15s/it]Evaluating commonsenseqa :  86%|████████████████████████████████████████████████████████████▏         | 43/50 [35:21<06:10, 52.97s/it]Evaluating commonsenseqa :  88%|█████████████████████████████████████████████████████████████▌        | 44/50 [36:14<05:18, 53.11s/it]Evaluating commonsenseqa :  90%|███████████████████████████████████████████████████████████████       | 45/50 [37:10<04:29, 53.83s/it]Evaluating commonsenseqa :  92%|████████████████████████████████████████████████████████████████▍     | 46/50 [38:07<03:39, 54.92s/it]Evaluating commonsenseqa :  94%|█████████████████████████████████████████████████████████████████▊    | 47/50 [39:04<02:46, 55.57s/it]Evaluating commonsenseqa :  96%|███████████████████████████████████████████████████████████████████▏  | 48/50 [39:16<01:24, 42.44s/it]Evaluating commonsenseqa :  98%|████████████████████████████████████████████████████████████████████▌ | 49/50 [39:52<00:40, 40.37s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:47<00:00, 44.92s/it]Evaluating commonsenseqa : 100%|██████████████████████████████████████████████████████████████████████| 50/50 [40:47<00:00, 48.95s/it]
name: commonsenseqa | {'exact_match': 0.0, 'rougeL': 2.6438} | lm_loss 7.6881 | avg. gen lenth: 207.764
